<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Example 1: Configure CRR When Source and Destination
         Buckets Are Owned by the Same AWS Account - Amazon Simple Storage Service
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="crr-example-walkthroughs.html" title="Cross-Region Replication (CRR) Walkthroughs">
      <link rel="prev" href="crr-example-walkthroughs.html" title="Cross-Region Replication (CRR) Walkthroughs">
      <link rel="next" href="crr-walkthrough-2.html" title="Example 2: Configure CRR When Source and Destination
            Buckets Are Owned by Different AWS Accounts">
      <meta name="description" content="TBD">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon Simple Storage Service">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/crr-walkthrough1.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/s3/index.html">Amazon Simple Storage Service (S3)</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="crr.html">Cross-Region Replication</a> &#xBB; <a href="crr-example-walkthroughs.html">Cross-Region Replication (CRR) Walkthroughs</a> &#xBB; <span class="breadcrumb">Example 1: Configure CRR When Source and Destination
                                    Buckets Are Owned by the Same AWS Account</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="crr-walkthrough1">Example 1: Configure CRR When Source and Destination
                        Buckets Are Owned by the Same AWS Account
                     </h1>
                     <p>In this example, you set up cross-region replication (CRR) where source and destination
                        buckets are owned by the same AWS accounts. Examples are provided for using the Amazon
                        S3
                        console, the AWS Command Line Interface (AWS CLI), and the AWS SDK for Java and AWS
                        SDK for .NET.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul></ul>
                     </div>
                     <div class="collapsible">
                        <div id="crr-ex1-console" class="collapsible-header">Configure CRR When Source and Destination Buckets
                           Are Owned by the Same AWS Account (Console)
                        </div>
                        <div class="collapsible-content">
                           
                           
                           <p>For step-by-step instructions, see <a href="./AmazonS3/latest/user-guide/enable-crr.html">How
                                 Do I Add a Cross-Region Replication (CRR) Rule to an S3 Bucket?</a> in the
                              <em>Amazon Simple Storage Service Console User Guide</em>. This topic provides
                              instructions for setting replication configuration when buckets are owned by same
                              and different AWS accounts.
                           </p>
                           
                        </div>
                        <div id="crr-ex1-cli" class="collapsible-header">Configure CRR When Source and Destination Buckets Are
                           Owned by the Same AWS Account (AWS CLI)
                        </div>
                        <div class="collapsible-content">
                           
                           
                           <p>To set up CRR when the source and destination buckets are owned by the same AWS
                              account with the AWS CLI, you create source and destination buckets, enable versioning
                              on the buckets, create an IAM role that gives Amazon S3 permission to replicate
                              objects, and add the replication configuration to the source bucket. To verify your
                              setup, you test it.
                           </p>
                           
                           <p class="title"><b>To set up CRR replication when source and destination buckets are owned by
                                 the same AWS account </b></p>
                           <ol>
                              <li>
                                 
                                 <p>Set a credentials profile for the AWS CLI. In this example, we use the
                                    profile name <code class="code">acctA</code>. For information about setting credential
                                    profiles, see <a href="./cli/latest/userguide/cli-multiple-profiles.html">Named Profiles</a> in the <em>AWS Command Line Interface User Guide</em>. 
                                 </p>
                                 
                                 <div class="aws-note">
                                    <p class="aws-note">Important</p>
                                    <p>The profile you use for this exercise must have necessary permissions.
                                       For example, in the replication configuration, you specify the IAM
                                       role that Amazon S3 can assume. You can do this only if the profile you use
                                       has the <code class="code">iam:PassRole</code> permission. For more information, see
                                       <a href="./IAM/latest/UserGuide/id_roles_use_passrole.html">Granting a
                                          User Permissions to Pass a Role to an AWS Service</a> in the
                                       <em>IAM User Guide</em>. If you use an administrator
                                       user credentials to create a named profile then you can perform all the
                                       tasks. 
                                    </p>
                                 </div>
                                 
                              </li>
                              <li>
                                 
                                 <p>Create a <em class="replaceable"><code>source</code></em> bucket and enable versioning on
                                    it. The following code creates a <em class="replaceable"><code>source</code></em> bucket in
                                    the US East (N. Virginia) (us-east-1) Region.
                                 </p>
                                 
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3api create-bucket \
--bucket <em class="replaceable"><code>source</code></em> \
--region us-east-1 \
--profile acctA</code></pre>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3api put-bucket-versioning \
--bucket <em class="replaceable"><code>source</code></em> \
--versioning-configuration Status=Enabled \
--profile acctA</code></pre>
                                 </li>
                              <li>
                                 
                                 <p>Create a <em class="replaceable"><code>destination</code></em> bucket and enable
                                    versioning on it. The following code creates a
                                    <em class="replaceable"><code>destination</code></em> bucket in the US West (Oregon)
                                    (us-west-2) Region. 
                                 </p>
                                 
                                 <div class="aws-note">
                                    <p class="aws-note">Note</p>
                                    <p>To set up replication configuration when both source and destination
                                       buckets are in the same AWS account, you use the same profile. In this
                                       example, we use <code class="code">acctA</code>. To test replication configuration
                                       when the buckets are owned by different AWS accounts, you specify
                                       different profiles for each. In this example, we use the
                                       <code class="code">acctB</code> profile for the destination bucket.
                                    </p>
                                 </div>
                                 
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3api create-bucket \
--bucket <em class="replaceable"><code>destination</code></em> \
--region us-west-2 \
--create-bucket-configuration LocationConstraint=us-west-2 \
--profile acctA</code></pre>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws s3api put-bucket-versioning \
--bucket <em class="replaceable"><code>destination</code></em> \
--versioning-configuration Status=Enabled \
--profile acctA</code></pre>
                                 </li>
                              <li>
                                 
                                 <p>Create an IAM role. You specify this role in the replication
                                    configuration that you add to the <em class="replaceable"><code>source</code></em> bucket
                                    later. Amazon S3 assumes this role to replicate objects on your behalf. You
                                    create an IAM role in two steps:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>Create a role</p>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>Attach a permissions policy to the role.</p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p>Create the IAM role.</p>
                                       
                                       <ol>
                                          <li>
                                             
                                             <p>Copy the following trust policy and save it to a to a file
                                                called <code class="code">S3-role-trust-policy.json</code> in the current
                                                directory on your local computer. This policy grants Amazon S3
                                                service principal permissions to assume the role.
                                             </p>
                                             <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
   &quot;Version&quot;:&quot;2012-10-17&quot;,
   &quot;Statement&quot;:[
      {
         &quot;Effect&quot;:&quot;Allow&quot;,
         &quot;Principal&quot;:{
            &quot;Service&quot;:&quot;s3.amazonaws.com&quot;
         },
         &quot;Action&quot;:&quot;sts:AssumeRole&quot;
      }
   ]
}</code></pre>
                                             </li>
                                          <li>
                                             
                                             <p>Run the following command to create a role:</p>
                                             <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code>aws iam create-role \
--role-name crrRole \
--assume-role-policy-document file://s3-role-trust-policy.json  \
--profile acctA</code></pre>
                                             </li>
                                       </ol>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Attach a permissions policy to the role.</p>
                                       
                                       <ol>
                                          <li>
                                             
                                             <p>Copy the following permissions policy and save it to a
                                                file named <code class="code">S3-role-permissions-policy.json</code> in
                                                the current directory on your local computer. This policy
                                                grants permissions for various Amazon S3 bucket and object
                                                actions. 
                                             </p>
                                             <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
   &quot;Version&quot;:&quot;2012-10-17&quot;,
   &quot;Statement&quot;:[
      {
         &quot;Effect&quot;:&quot;Allow&quot;,
         &quot;Action&quot;:[
            &quot;s3:GetObjectVersionForReplication&quot;,
            &quot;s3:GetObjectVersionAcl&quot;
         ],
         &quot;Resource&quot;:[
            &quot;arn:aws:s3:::<em class="replaceable"><code>source-bucket</code></em>/*&quot;
         ]
      },
      {
         &quot;Effect&quot;:&quot;Allow&quot;,
         &quot;Action&quot;:[
            &quot;s3:ListBucket&quot;,
            &quot;s3:GetReplicationConfiguration&quot;
         ],
         &quot;Resource&quot;:[
            &quot;arn:aws:s3:::<em class="replaceable"><code>source-bucket</code></em>&quot;
         ]
      },
      {
         &quot;Effect&quot;:&quot;Allow&quot;,
         &quot;Action&quot;:[
            &quot;s3:ReplicateObject&quot;,
            &quot;s3:ReplicateDelete&quot;,
            &quot;s3:ReplicateTags&quot;,
            &quot;s3:GetObjectVersionTagging&quot;

         ],
         &quot;Resource&quot;:&quot;arn:aws:s3:::<em class="replaceable"><code>destination-bucket</code></em>/*&quot;
      }
   ]
}</code></pre>
                                             </li>
                                          <li>
                                             
                                             <p>Run the following command to create a policy and attach it
                                                to the role:
                                             </p>
                                             <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code>aws iam put-role-policy \
--role-name crrRole \
--policy-document file://s3-role-permissions-policy.json \
--policy-name crrRolePolicy \
--profile acctA</code></pre>
                                             </li>
                                       </ol>
                                       
                                    </li>
                                 </ol>
                                 
                              </li>
                              <li>
                                 
                                 <p>Add replication configuration to the <em class="replaceable"><code>source</code></em>
                                    bucket. 
                                 </p>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p>Although the Amazon S3 API requires replication configuration as XML,
                                          the AWS CLI requires that you specify the replication configuration as
                                          JSON. Save the following JSON in a file called
                                          <code class="code">replication.json</code> to the local directory on your
                                          computer.
                                       </p>
                                       
                                       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  &quot;Role&quot;: &quot;<em class="replaceable"><code>IAM-role-ARN</code></em>&quot;,
  &quot;Rules&quot;: [
    {
      &quot;Status&quot;: &quot;Enabled&quot;,
      &quot;Priority&quot;: 1,
      &quot;DeleteMarkerReplication&quot;: { &quot;Status&quot;: &quot;Disabled&quot; },
      &quot;Filter&quot; : { &quot;Prefix&quot;: &quot;Tax&quot;},
      &quot;Destination&quot;: {
        &quot;Bucket&quot;: &quot;arn:aws:s3:::<em class="replaceable"><code>destination-bucket</code></em>&quot;
      }
    }
  ]
}</code></pre>
                                       </li>
                                    <li>
                                       
                                       <p>Update the JSON by providing values for the
                                          <em class="replaceable"><code>destination-bucket</code></em> and
                                          <em class="replaceable"><code>IAM-role-ARN</code></em>. Save the
                                          changes.
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Run the following command to add the replication configuration to
                                          your source bucket. Be sure to provide
                                          <em class="replaceable"><code>source-bucket</code></em> name.
                                       </p>
                                       <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code>aws s3api put-bucket-replication \
--replication-configuration file://replication.json \
--bucket <em class="replaceable"><code>source</code></em> \
--profile acctA</code></pre>
                                       </li>
                                 </ol>
                                 
                                 <p>To retrieve the replication configuration, use the
                                    <code class="code">get-bucket-replication</code> command: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code>aws s3api get-bucket-replication \
--bucket <em class="replaceable"><code>source</code></em> \
--profile acctA</code></pre>
                                 </li>
                              <li>
                                 
                                 <p>Test the setup in the Amazon S3 console: </p>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p> Sign in to the AWS Management Console and open the Amazon S3
                                          console at <a href="https://console.aws.amazon.com/s3/" target="_blank">https://console.aws.amazon.com/s3/</a>
                                          
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>In the <em class="replaceable"><code>source</code></em> bucket, create a folder
                                          named <code>Tax</code>. 
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Add sample objects to the <code>Tax</code> folder in the
                                          <em class="replaceable"><code>source</code></em> bucket. 
                                       </p>
                                       
                                       <div class="aws-note">
                                          <p class="aws-note">Note</p>
                                          <p>The amount of time it takes for Amazon S3 to replicate an object
                                             depends on the size of the object. For information about how to
                                             see the status of replication, see <a href="crr-status.html">Cross-Region Replication Status Information</a>.
                                          </p>
                                       </div>
                                       
                                       <p>In the <em class="replaceable"><code>destination</code></em> bucket, verify the
                                          following:
                                       </p>
                                       
                                       <div class="itemizedlist">
                                          
                                          
                                          
                                          
                                          <ul class="itemizedlist" type="disc">
                                             <li class="listitem">
                                                
                                                <p>That Amazon S3 replicated the objects.</p>
                                                
                                             </li>
                                             <li class="listitem">
                                                
                                                <p>In object <b>properties</b>, that the
                                                   <b>Replication Status</b> is set to
                                                   <code class="code">Replica</code> (identifying this as a replica
                                                   object).
                                                </p>
                                                
                                             </li>
                                             <li class="listitem">
                                                
                                                <p>In object <b>properties</b>, that the
                                                   permission section shows no permissions. This means that the
                                                   replica is still owned by the
                                                   <em class="replaceable"><code>source</code></em> bucket owner, and the
                                                   <em class="replaceable"><code>destination</code></em> bucket owner has
                                                   no permission on the object replica. You can add optional
                                                   configuration to tell Amazon S3 to change the replica ownership.
                                                   For an example, see <a href="crr-walkthrough-3.html">Example 3: Change Replica Owner When Source and
                                                      Destination Buckets Are Owned by Different AWS Accounts</a>. 
                                                </p>
                                                
                                                <div class="mediaobject">
                                                   
                                                   
                                                   <img src="../../..//img/crr-wt2-10.png" alt="
                                            Screen shot of object properties showing the
                                                replication status and permissions.
                                        ">
                                                   
                                                   
                                                </div>
                                                
                                             </li>
                                          </ul>
                                       </div>
                                       
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Update an object&apos;s ACL in the <em class="replaceable"><code>source</code></em>
                                          bucket and verify that changes appear in the
                                          <em class="replaceable"><code>destination</code></em> bucket.
                                       </p>
                                       
                                       <p>For instructions, see <a href="./AmazonS3/latest/user-guide/set-object-permissions.html">How Do I Set
                                             Permissions on an Object?</a> in the
                                          <em>Amazon Simple Storage Service Console User Guide</em>.
                                       </p>
                                       
                                    </li>
                                 </ol>
                                 
                              </li>
                           </ol>
                           
                        </div>
                        <div id="crr-ex1-sdk" class="collapsible-header">Configure CRR When Source and Destination Buckets Are
                           Owned by the Same AWS Account (AWS SDK)
                        </div>
                        <div class="collapsible-content">
                           
                           
                           <p>Use the following code examples to add a replication configuration to a bucket
                              with the AWS SDK for Java and AWS SDK for .NET., respectively.
                           </p>
                           
                           <div class="option container">
                              <div class="optionselector"><span class="optionanchor" id=""><span class="option  selected" data-tab="java">Java</span></span><span class="optionanchor" id=""><span class="option " data-tab="c#">C#</span></span></div>
                              <dl>
                                 <dt>Java</dt>
                                 <dd class="selected" data-tab="java">
                                    <p>The following example adds a replication configuration to a bucket and
                                       then retrieves and verifies the configuration. For instructions on
                                       creating and testing a working sample, see <a href="UsingTheMPJavaAPI.html#TestingJavaSamples">Testing the Amazon S3 Java Code Examples</a>. 
                                    </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="java ">
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

import com.amazonaws.AmazonServiceException;
import com.amazonaws.SdkClientException;
import com.amazonaws.auth.profile.ProfileCredentialsProvider;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3ClientBuilder;
import com.amazonaws.services.s3.model.BucketReplicationConfiguration;
import com.amazonaws.services.s3.model.ReplicationDestinationConfig;
import com.amazonaws.services.s3.model.ReplicationRule;
import com.amazonaws.services.s3.model.ReplicationRuleStatus;
import com.amazonaws.services.s3.model.StorageClass;

public class CrossRegionReplication {

    public static void main(String[] args) throws IOException {
        String clientRegion = &quot;*** Client region ***&quot;;
        String accountId = &quot;*** Account ID ***&quot;;
        String roleName = &quot;*** Role name ***&quot;;
        String sourceBucketName = &quot;*** Source bucket name ***&quot;;
        String destBucketName = &quot;*** Destination bucket name ***&quot;;
        String prefix = &quot;Tax/&quot;;
        
        String roleARN = String.format(&quot;arn:aws:iam::%s:role/%s&quot;, accountId, roleName);
        String destinationBucketARN = &quot;arn:aws:s3:::&quot; + destBucketName;
   
        try {
            AmazonS3 s3Client = AmazonS3ClientBuilder.standard()
                    .withCredentials(new ProfileCredentialsProvider())
                    .withRegion(clientRegion)
                    .build();

            // Create the replication rule.
            List&lt;ReplicationFilterPredicate&gt; andOperands = new ArrayList&lt;ReplicationFilterPredicate&gt;();
            andOperands.add(new ReplicationPrefixPredicate(&quot;prefix&quot;));

            
            Map&lt;String, ReplicationRule&gt; replicationRules = new HashMap&lt;String, ReplicationRule&gt;();
            replicationRules.put(&quot;ReplicationRule1&quot;,
                                 new ReplicationRule()
                                     .withPriority(0)
                                     .withStatus(ReplicationRuleStatus.Enabled)
                                     .withDeleteMarkerReplication(new DeleteMarkerReplication().withStatus(DeleteMarkerReplicationStatus.DISABLED))
                                     .withFilter(new ReplicationFilter().withPredicate(new ReplicationAndOperator(andOperands)))
                                     .withDestinationConfig(new ReplicationDestinationConfig()
                                                                     .withBucketARN(destinationBucketARN)
                                                                     .withStorageClass(StorageClass.Standard)));
            
            // Save the replication rule to the source bucket.
            s3Client.setBucketReplicationConfiguration(sourceBucketName,
                                                       new BucketReplicationConfiguration()
                                                               .withRoleARN(roleARN)
                                                               .withRules(replicationRules));
    
            // Retrieve the replication configuration and verify that the configuration
            // matches the rule we just set.
            BucketReplicationConfiguration replicationConfig = s3Client.getBucketReplicationConfiguration(sourceBucketName);
            ReplicationRule rule = replicationConfig.getRule(&quot;ReplicationRule1&quot;);
            System.out.println(&quot;Retrieved destination bucket ARN: &quot; + rule.getDestinationConfig().getBucketARN());
            System.out.println(&quot;Retrieved source-bucket replication rule prefix: &quot; + rule.getPrefix());
            System.out.println(&quot;Retrieved source-bucket replication rule status: &quot; + rule.getStatus());
        }
        catch(AmazonServiceException e) {
            // The call was transmitted successfully, but Amazon S3 couldn&apos;t process 
            // it, so it returned an error response.
            e.printStackTrace();
        }
        catch(SdkClientException e) {
            // Amazon S3 couldn&apos;t be contacted for a response, or the client
            // couldn&apos;t parse the response from Amazon S3.
            e.printStackTrace();
        }
    }
}

</code></pre></dd>
                                 <dt>C#</dt>
                                 <dd class="" data-tab="c#">
                                    <p>The following AWS SDK for .NET code example adds a replication configuration
                                       to a bucket and then retrieves it. To use this code, provide the names
                                       for your buckets and the Amazon Resource Name (ARN) for your IAM role.
                                       For instructions on how to create and test a working sample, see <a href="UsingTheMPDotNetAPI.html#TestingDotNetApiSamples">Running the Amazon S3 .NET Code Examples</a>.
                                    </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="cs ">// Copyright 2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.
// SPDX-License-Identifier: MIT-0 (For details, see https://github.com/awsdocs/amazon-s3-developer-guide/blob/master/LICENSE-SAMPLECODE.)

&#xFEFF;using Amazon.S3;
using Amazon.S3.Model;
using System;
using System.Threading.Tasks;

namespace Amazon.DocSamples.S3
{
    class CrossRegionReplicationTest
    {
        private const string sourceBucket = &quot;*** source bucket ***&quot;;
        // Bucket ARN example - arn:aws:s3:::destinationbucket
        private const string destinationBucketArn = &quot;*** destination bucket ARN ***&quot;;
        private const string roleArn = &quot;*** IAM Role ARN ***&quot;;
        // Specify your bucket region (an example region is shown).
        private static readonly RegionEndpoint sourceBucketRegion = RegionEndpoint.USWest2;
        private static IAmazonS3 s3Client;
        public static void Main()
        {
            s3Client = new AmazonS3Client(sourceBucketRegion);
            EnableReplicationAsync().Wait();
        }
        static async Task EnableReplicationAsync()
        {
            try
            {
                ReplicationConfiguration replConfig = new ReplicationConfiguration
                {
                    Role = roleArn,
                    Rules =
                        {
                            new ReplicationRule
                            {
                                Prefix = &quot;Tax&quot;,
                                Status = ReplicationRuleStatus.Enabled,
                                Destination = new ReplicationDestination
                                {
                                    BucketArn = destinationBucketArn
                                }
                            }
                        }
                };

                PutBucketReplicationRequest putRequest = new PutBucketReplicationRequest
                {
                    BucketName = sourceBucket,
                    Configuration = replConfig
                };

                PutBucketReplicationResponse putResponse = await s3Client.PutBucketReplicationAsync(putRequest);

                // Verify configuration by retrieving it.
                await RetrieveReplicationConfigurationAsync(s3Client);
            }
            catch (AmazonS3Exception e)
            {
                Console.WriteLine(&quot;Error encountered on server. Message:&apos;{0}&apos; when writing an object&quot;, e.Message);
            }
            catch (Exception e)
            {
                Console.WriteLine(&quot;Unknown encountered on server. Message:&apos;{0}&apos; when writing an object&quot;, e.Message);
            }
        }
        private static async Task RetrieveReplicationConfigurationAsync(IAmazonS3 client)
        {
            // Retrieve the configuration.
            GetBucketReplicationRequest getRequest = new GetBucketReplicationRequest
            {
                BucketName = sourceBucket
            };
            GetBucketReplicationResponse getResponse = await client.GetBucketReplicationAsync(getRequest);
            // Print.
            Console.WriteLine(&quot;Printing replication configuration information...&quot;);
            Console.WriteLine(&quot;Role ARN: {0}&quot;, getResponse.Configuration.Role);
            foreach (var rule in getResponse.Configuration.Rules)
            {
                Console.WriteLine(&quot;ID: {0}&quot;, rule.Id);
                Console.WriteLine(&quot;Prefix: {0}&quot;, rule.Prefix);
                Console.WriteLine(&quot;Status: {0}&quot;, rule.Status);
            }
        }
    }
}</code></pre></dd>
                              </dl>
                           </div>
                           
                        </div>
                     </div>
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="crr-example-walkthroughs.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="crr-walkthrough-2.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper"></div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Simple Storage Service';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>