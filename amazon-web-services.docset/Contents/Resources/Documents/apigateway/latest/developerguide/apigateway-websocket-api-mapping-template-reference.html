<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>API Gateway WebSocket API
         Mapping Template Reference - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-websocket-api.html" title="Creating, Deploying, and Invoking a WebSocket API
            in Amazon API Gateway">
      <link rel="prev" href="apigateway-websocket-api-selection-expressions.html" title="WebSocket Selection
            Expressions in API Gateway">
      <link rel="next" href="apigateway-publish-your-apis.html" title="Publishing Your API Gateway APIs">
      <meta name="description" content="This section summarizes the set of variables that are currently supported for WebSocket APIs in API Gateway.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-websocket-api-mapping-template-reference.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/apigateway/index.html">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-websocket-api.html">Creating, Deploying, and Invoking a WebSocket API
                                    in Amazon API Gateway</a> &#xBB; <span class="breadcrumb">API Gateway WebSocket API
                                    Mapping Template Reference</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-websocket-api-mapping-template-reference">API Gateway WebSocket API
                        Mapping Template Reference
                     </h1>
                     <p>This section summarizes the set of variables that are currently supported for WebSocket
                        APIs in API Gateway.
                     </p>
                     <div class="table">
                        <div class="table-contents">
                           <table id="w468aac15c27b5">
                              
                              <tbody><tr>
                                 
                                 <th>Parameter</th>
                                 
                                 <th>Description</th>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$context.connectionId</code></td>
                                 
                                 <td>
                                    
                                    <p>A unique ID for the connection that can be used to make a callback to
                                       the client.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.connectedAt</code></td>
                                 
                                 <td>
                                    
                                    <p>The <a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank">Epoch</a>-formatted connection time.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$context.domainName</code></td>
                                 
                                 <td>
                                    
                                    <p>A domain name for the WebSocket API. This can be used to make a
                                       callback to the client (instead of a hard-coded value).
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.eventType</code></td>
                                 
                                 <td>
                                    
                                    <p>The event type: <code class="code">CONNECT</code>, <code class="code">MESSAGE</code>, or
                                       <code class="code">DISCONNECT</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.messageId</code></td>
                                 
                                 <td>
                                    
                                    <p>A unique server-side ID for a message. Available only when the
                                       <code class="code">$context.eventType</code> is <code class="code">MESSAGE</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.routeKey</code></td>
                                 
                                 <td>
                                    
                                    <p>The selected route key.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestId</code></td>
                                 
                                 <td>
                                    
                                    <p>Same as <code class="code">$context.extendedRequestId</code>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.extendedRequestId</code></td>
                                 
                                 <td>An automatically generated ID for the API call, which contains more
                                    useful information for debugging/troubleshooting.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.apiId</code></td>
                                 
                                 <td>
                                    
                                    <p>The identifier API Gateway assigns to your API.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.authorizer.principalId</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal user identification associated with the token sent by
                                       the client and returned from an API Gateway Lambda authorizer (formerly known
                                       as a custom authorizer) Lambda function.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.authorizer.<em class="replaceable"><code>property</code></em></code></td>
                                 
                                 <td>
                                    
                                    <p>The stringified value of the specified key-value pair of the <code class="literal">context</code> map returned from an API Gateway Lambda
                                       authorizer function. For example, if the authorizer returns the
                                       following <code class="code">context</code> map: 
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">&quot;context&quot; : {
  &quot;key&quot;: &quot;value&quot;,
  &quot;numKey&quot;: 1,
  &quot;boolKey&quot;: true
}</code></pre>
                                    <p>calling <code class="code">$context.authorizer.key</code> returns the
                                       <code class="code">&quot;value&quot;</code> string, calling
                                       <code class="code">$context.authorizer.numKey</code> returns the <code class="code">&quot;1&quot;</code>
                                       string, and calling <code class="code">$context.authorizer.boolKey</code> returns the
                                       <code class="code">&quot;true&quot;</code> string.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.message</code></td>
                                 
                                 <td>
                                    
                                    <p>A string containing an API Gateway error message. This variable can only be
                                       used in access logging.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.messageString</code></td>
                                 
                                 <td>The quoted value of <code class="code">$context.error.message</code>, namely
                                    <code class="code">&quot;$context.error.message&quot;</code>.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.responseType</code></td>
                                 
                                 <td>
                                    
                                    <p>The error response type. This variable can only be used in access
                                       logging.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.error.validationErrorString</code></td>
                                 
                                 <td>
                                    
                                    <p>A string containing a detailed validation error message.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.accountId</code></td>
                                 
                                 <td>
                                    
                                    <p>The AWS account ID associated with the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.apiKey</code></td>
                                 
                                 <td>
                                    
                                    <p>The API owner key associated with key-enabled API request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.apiKeyId</code></td>
                                 
                                 <td>The API key ID associated with the key-enabled API request</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.caller</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal identifier of the caller making the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.cognitoAuthenticationProvider</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Cognito authentication provider used by the caller making the
                                       request. Available only if the request was signed with Amazon Cognito
                                       credentials.
                                    </p>
                                    
                                    <p>For information related to this and the other Amazon Cognito
                                       <code class="code">$context</code> variables, see <a href="./cognito/latest/developerguide/cognito-identity.html">Using Federated
                                          Identities</a> in the <em>Amazon Cognito Developer
                                          Guide</em>.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              
                              
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.sourceIp</code></td>
                                 
                                 <td>
                                    
                                    <p>The source IP address of the TCP connection making the request to
                                       API Gateway.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.user</code></td>
                                 
                                 <td>
                                    
                                    <p>The principal identifier of the user making the request.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.userAgent</code></td>
                                 
                                 <td>
                                    
                                    <p>The User Agent of the API caller.</p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.identity.userArn</code></td>
                                 
                                 <td>
                                    
                                    <p>The Amazon Resource Name (ARN) of the effective user identified after
                                       authentication.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.integrationLatency</code></td>
                                 
                                 <td>The integration latency in ms, available for access logging only.</td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestTime</code></td>
                                 
                                 <td>The <a href="https://httpd.apache.org/docs/1.3/logs.html#common" target="_blank">CLF</a>-formatted request time (<code class="code">dd/MMM/yyyy:HH:mm:ss
                                       +-hhmm</code>).
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.requestTimeEpoch</code></td>
                                 
                                 <td>The <a href="https://en.wikipedia.org/wiki/Unix_time" target="_blank">Epoch</a>-formatted request time.
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$context.stage</code></td>
                                 
                                 <td>
                                    
                                    <p>The deployment stage of the API call (for example, Beta or
                                       Prod).
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.body</code></td>
                                 
                                 <td>
                                    <p>Returns the raw payload as a string.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.json(x)</code></td>
                                 
                                 <td>
                                    <p>This function evaluates a JSONPath expression and returns the
                                       results as a JSON string.
                                    </p>
                                    
                                    <p>For example, <code class="code">$input.json(&apos;$.pets&apos;)</code> will return a JSON
                                       string representing the pets structure.
                                    </p>
                                    
                                    <p>For more information about JSONPath, see <a href="http://goessner.net/articles/JsonPath/" target="_blank">JSONPath</a> or
                                       <a href="https://github.com/jayway/JsonPath" target="_blank">JSONPath for
                                          Java</a>.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$input.path(x)</code></td>
                                 
                                 <td>
                                    <p>Takes a JSONPath expression string (<code class="code">x</code>) and returns
                                       a JSON object representation of the result. This allows you to
                                       access and manipulate elements of the payload natively in <a href="http://velocity.apache.org/engine/devel/vtl-reference-guide.html" target="_blank">Apache Velocity Template Language (VTL)</a>.
                                    </p>
                                    
                                    <p>For example, if the expression <code class="code">$input.path(&apos;$.pets&apos;)</code>
                                       returns an object like this:
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">[
  { 
    &quot;id&quot;: 1, 
    &quot;type&quot;: &quot;dog&quot;, 
    &quot;price&quot;: 249.99 
  }, 
  { 
    &quot;id&quot;: 2, 
    &quot;type&quot;: &quot;cat&quot;, 
    &quot;price&quot;: 124.99 
  }, 
  { 
    &quot;id&quot;: 3, 
    &quot;type&quot;: &quot;fish&quot;, 
    &quot;price&quot;: 0.99 
  } 
]</code></pre>
                                    <p><code class="code">$input.path(&apos;$.pets&apos;).count()</code> would return
                                       <code class="code">&quot;3&quot;</code>.
                                    </p>
                                    
                                    <p>For more information about JSONPath, see <a href="http://goessner.net/articles/JsonPath/" target="_blank">JSONPath</a> or
                                       <a href="https://github.com/jayway/JsonPath" target="_blank">JSONPath for
                                          Java</a>.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$stageVariables.<em class="replaceable"><code>&lt;variable_name&gt;</code></em></code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents a stage
                                       variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$stageVariables[&apos;<em class="replaceable"><code>&lt;variable_name&gt;</code></em>&apos;]</code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents any stage
                                       variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">${stageVariables[&apos;<em class="replaceable"><code>&lt;variable_name&gt;</code></em>&apos;]}</code></td>
                                 
                                 <td>
                                    
                                    <p><em class="replaceable"><code>&lt;variable_name&gt;</code></em> represents any stage
                                       variable name.
                                    </p>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.escapeJavaScript()</code></td>
                                 
                                 <td>
                                    
                                    <p>Escapes the characters in a string using JavaScript string
                                       rules.
                                    </p>
                                    
                                    <div class="aws-note">
                                       <p class="aws-note">Note</p>
                                       <p>This function will turn any regular single quotes (<code class="code">&apos;</code>)
                                          into escaped ones (<code class="code">\&apos;</code>). However, the escaped single
                                          quotes are not valid in JSON. Thus, when the output from this
                                          function is used in a JSON property, you must turn any escaped
                                          single quotes (<code class="code">\&apos;</code>) back to regular single quotes
                                          (<code class="code">&apos;</code>). This is shown in the following example: 
                                       </p><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"> $util.escapeJavaScript(<em class="replaceable"><code>data</code></em>).replaceAll(&quot;\\&apos;&quot;,&quot;&apos;&quot;)</code></pre></div>
                                    
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.parseJson()</code></td>
                                 
                                 <td>
                                    
                                    <p> Takes &quot;stringified&quot; JSON and returns an object representation of the
                                       result. You can use the result from this function to access and
                                       manipulate elements of the payload natively in Apache Velocity Template
                                       Language (VTL). For example, if you have the following payload: 
                                    </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{&quot;errorMessage&quot;:&quot;{\&quot;key1\&quot;:\&quot;var1\&quot;,\&quot;key2\&quot;:{\&quot;arr\&quot;:[1,2,3]}}&quot;}</code></pre>
                                    <p> and use the following mapping template </p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">#set ($errorMessageObj = $util.parseJson($input.path(&apos;$.errorMessage&apos;)))
{
   &quot;errorMessageObjKey2ArrVal&quot; : $errorMessageObj.key2.arr[0]
}
</code></pre>
                                    <p>You will get the following output:</p>
                                    <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;errorMessageObjKey2ArrVal&quot; : 1
}
</code></pre>
                                    </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.urlEncode()</code></td>
                                 
                                 <td>
                                    <p>Converts a string into &quot;application/x-www-form-urlencoded&quot;
                                       format.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.urlDecode()</code></td>
                                 
                                 <td>
                                    <p>Decodes an &quot;application/x-www-form-urlencoded&quot;
                                       string.
                                    </p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.base64Encode()</code></td>
                                 
                                 <td>
                                    <p>Encodes the data into a base64-encoded string.</p>
                                 </td>
                                 
                              </tr>
                              
                              <tr>
                                 
                                 <td><code class="code">$util.base64Decode()</code></td>
                                 
                                 <td>
                                    <p>Decodes the data from a base64-encoded string.</p>
                                 </td>
                                 
                              </tr>
                              
                           </tbody></table>
                        </div>
                     </div>
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-websocket-api-selection-expressions.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="apigateway-publish-your-apis.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper"></div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>