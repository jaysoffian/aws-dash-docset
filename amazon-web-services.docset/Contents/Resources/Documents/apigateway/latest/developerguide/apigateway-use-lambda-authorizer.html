<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Use API Gateway Lambda Authorizers - Amazon API Gateway</title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-control-access-to-api.html" title="Controlling and Managing Access to a REST
			API in API Gateway">
      <link rel="prev" href="apigateway-control-access-tags.html" title="Using Tags to Control Access to a
            REST API in API Gateway">
      <link rel="next" href="configure-api-gateway-lambda-authorization-with-console.html" title="Configure a
                Lambda Authorizer Using the API Gateway Console">
      <meta name="description" content="Enable an Amazon API Gateway Lambda authorizer to authenticate API requests.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/apigateway/index.html">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-rest-api.html">Creating, Deploying, and Invoking a REST API
                                    in Amazon API Gateway</a> &#xBB; <a href="apigateway-control-access-to-api.html">Controlling and Managing Access to a REST
                                    			API in API Gateway</a> &#xBB; <span class="breadcrumb">Use API Gateway Lambda Authorizers</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-use-lambda-authorizer">Use API Gateway Lambda Authorizers</h1>
                     <p>A <em>Lambda authorizer</em> (formerly known as a <em>custom
                           authorizer</em>) is an API Gateway feature that uses a Lambda function to control access
                        to your API.
                     </p>
                     <p>A Lambda authorizer is useful if you want to implement a custom authorization scheme
                        that
                        uses a bearer token authentication strategy such as OAuth or SAML, or that uses request
                        parameters to determine the caller&apos;s identity.
                     </p>
                     <p>When a client makes a request to one of your API&apos;s methods, API Gateway calls your
                        Lambda
                        authorizer, which takes the caller&apos;s identity as input and returns an IAM policy as
                        output.
                     </p>
                     <p>There are two types of Lambda authorizers:</p>
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>A <em>token-based</em> Lambda authorizer (also called a
                                 <code class="code">TOKEN</code> authorizer) receives the caller&apos;s identity in a bearer token,
                                 such as a JSON Web Token (JWT) or an OAuth token.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>A <em>request parameter-based</em> Lambda authorizer (also called a
                                 <code class="code">REQUEST</code> authorizer) receives the caller&apos;s identity in a combination
                                 of headers, query string parameters, <a href="api-gateway-mapping-template-reference.html#stagevariables-template-reference">stageVariables</a>,
                                 and <a href="api-gateway-mapping-template-reference.html#context-variable-reference">$context</a>
                                 variables.
                              </p>
                              
                              <p>For WebSocket APIs, only request parameter-based authorizers are supported.</p>
                              
                           </li>
                        </ul>
                     </div>
                     <p>It is possible to use an AWS Lambda function from an AWS account that is different
                        from
                        the one in which you created your Lambda authorizer function. For more information,
                        see <a href="apigateway-lambda-authorizer-cross-account-lambda-authorizer.html">Configure
                           a Cross-Account Lambda Authorizer</a>.
                     </p>
                     <p>To see an example of a .NET Lambda authorizer, view the <a href="http://www.youtube.com/watch?v=-0EG17oVxV0&amp;feature=player_embedded" target="_blank">Creating an API Gateway Custom Authorizer in .NET Core 2.0</a> video.
                     </p>
                     <div class="highlights">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#api-gateway-lambda-authorizer-flow">Lambda Authorizer Auth
                                 Workflow</a></li>
                           <li><a href="#api-gateway-lambda-authorizer-create">Steps to Create an API Gateway Lambda
                                 Authorizer</a></li>
                           <li><a href="#api-gateway-lambda-authorizer-lambda-function-create">Create an API Gateway
                                 Lambda Authorizer Function in the Lambda Console</a></li>
                           <li><a href="configure-api-gateway-lambda-authorization-with-console.html">Configure a
                                 Lambda Authorizer Using the API Gateway Console</a></li>
                           <li><a href="configure-api-gateway-lambda-authorization-programmatically.html">Configure
                                 a Lambda Authorizer Using the AWS CLI or an AWS SDK</a></li>
                           <li><a href="api-gateway-lambda-authorizer-input.html">Input to an Amazon API Gateway Lambda
                                 Authorizer</a></li>
                           <li><a href="api-gateway-lambda-authorizer-output.html">Output from an Amazon API Gateway Lambda
                                 Authorizer</a></li>
                           <li><a href="call-api-with-api-gateway-lambda-authorization.html">Call an API with API Gateway
                                 Lambda Authorizers</a></li>
                           <li><a href="apigateway-lambda-authorizer-cross-account-lambda-authorizer.html">Configure
                                 a Cross-Account Lambda Authorizer</a></li>
                        </ul>
                     </div>
                     
                     <h2 id="api-gateway-lambda-authorizer-flow">Lambda Authorizer Auth
                        Workflow
                     </h2>
                     
                     <p>The following diagram illustrates the authorization workflow for Lambda
                        authorizers.
                     </p>
                     
                     <div class="mediaobject">
                        
                        <img src="../../..//img/custom-auth-workflow.png" alt="
                API Gateway Lambda authorization workflow
            " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     <p class="title"><b>API Gateway Lambda authorization workflow</b></p>
                     <ol>
                        <li>
                           
                           <p>The client calls a method on an API Gateway API method, passing a bearer token or
                              request parameters.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>API Gateway checks whether a Lambda authorizer is configured for the method. If it
                              is, API Gateway calls the Lambda function.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>The Lambda function authenticates the caller by means such as the
                              following:
                           </p>
                           
                           <div class="itemizedlist">
                              
                              
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Calling out to an OAuth provider to get an OAuth access token.</p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Calling out to a SAML provider to get a SAML assertion.</p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Generating an IAM policy based on the request parameter
                                       values.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Retrieving credentials from a database.</p>
                                    
                                 </li>
                              </ul>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>If the call succeeds, the Lambda function grants access by returning an output
                              object containing at least an IAM policy and a principal identifier.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>API Gateway evaluates the policy.</p>
                           
                           <div class="itemizedlist">
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>If access is denied, API Gateway returns a suitable HTTP status code, such
                                       as <code class="code">403 ACCESS_DENIED</code>.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>If access is allowed, API Gateway executes the method. If caching is enabled
                                       in the authorizer settings, API Gateway also caches the policy so that the
                                       Lambda authorizer function doesn&apos;t need to be invoked again.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-gateway-lambda-authorizer-create">Steps to Create an API Gateway Lambda
                        Authorizer
                     </h2>
                     
                     <p>To create a Lambda authorizer, you need to perform the following tasks:</p>
                     
                     <ol>
                        <li>
                           
                           <p>Create the Lambda authorizer function in the Lambda console as described in
                              <a href="apigateway-use-lambda-authorizer.html#api-gateway-lambda-authorizer-lambda-function-create">Create an API Gateway
                                 Lambda Authorizer Function in the Lambda Console</a>. You
                              can use one of the blueprint examples as a starting point and customize the
                              <a href="api-gateway-lambda-authorizer-input.html">input</a> and <a href="api-gateway-lambda-authorizer-output.html">output</a> as
                              desired.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Configure the Lambda function as an API Gateway authorizer and configure an API
                              method to require it, as described in <a href="configure-api-gateway-lambda-authorization-with-console.html">Configure a
                                 Lambda Authorizer Using the API Gateway Console</a>.
                              Alternatively, if you need a cross-account Lambda authorizer, see <a href="apigateway-lambda-authorizer-cross-account-lambda-authorizer.html">Configure
                                 a Cross-Account Lambda Authorizer</a>.
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>It is also possible to configure an authorizer by using the AWS CLI or an AWS SDK.
                                 See <a href="configure-api-gateway-lambda-authorization-programmatically.html">Configure
                                    a Lambda Authorizer Using the AWS CLI or an AWS SDK</a>.
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Test your authorizer by using <a href="https://www.getpostman.com/" target="_blank">Postman</a> as described in <a href="call-api-with-api-gateway-lambda-authorization.html">Call an API with API Gateway
                                 Lambda Authorizers</a>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-gateway-lambda-authorizer-lambda-function-create">Create an API Gateway
                        Lambda Authorizer Function in the Lambda Console
                     </h2>
                     
                     <p>Before configuring a Lambda authorizer, you must first create the Lambda function
                        that
                        implements the logic to authorize and, if necessary, to authenticate the caller. The
                        Lambda console provides a Python blueprint, which you can use by choosing <b>Use a
                           blueprint</b> and choosing the
                        <b>api-gateway-authorizer-python</b> blueprint. Otherwise, you&apos;ll want
                        to use one of the blueprints in the <a href="https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints" target="_blank">awslabs</a> GitHub repository as a starting point.
                     </p>
                     
                     <p>For the example Lambda authorizer functions in this section, which don&apos;t call other
                        services, you can use the built-in <a href="./lambda/latest/dg/lambda-intro-execution-role.html"><code class="code">AWSLambdaBasicExecutionRole</code></a>. When creating the Lambda
                        function for your own API Gateway Lambda authorizer, you&apos;ll need to assign an IAM
                        execution
                        role to the Lambda function if it calls other AWS services. To create the role, follow
                        the instructions in <a href="./lambda/latest/dg/lambda-intro-execution-role.html">AWS Lambda
                           Execution Role</a>.
                     </p>
                     
                     
                     
                     
                     
                     <h3 id="api-gateway-lambda-authorizer-token-lambda-function-create">EXAMPLE: Create a Token-Based Lambda Authorizer Function</h3>
                     
                     <p>To create a token-based Lambda authorizer function, enter the following Node.js
                        8.10 code in the Lambda console and test it in the API Gateway console as follows.
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>In the Lambda console, choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Author from scratch</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Enter a name for the function.</p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Runtime</b>, choose <b>Node.js
                                 8.10</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Copy/paste the following code into the code editor.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
// A simple token-based authorizer example to demonstrate how to use an authorization token 
// to allow or deny a request. In this example, the caller named &apos;user&apos; is allowed to invoke 
// a request if the client-supplied token value is &apos;allow&apos;. The caller is not allowed to invoke 
// the request if the token value is &apos;deny&apos;. If the token value is &apos;unauthorized&apos; or an empty
// string, the authorizer function returns an HTTP 401 status code. For any other token value, 
// the authorizer returns an HTTP 500 status code. 
// Note that token values are case-sensitive.

exports.handler =  function(event, context, callback) {
    var token = event.authorizationToken;
    switch (token) {
        case &apos;allow&apos;:
            callback(null, generatePolicy(&apos;user&apos;, &apos;Allow&apos;, event.methodArn));
            break;
        case &apos;deny&apos;:
            callback(null, generatePolicy(&apos;user&apos;, &apos;Deny&apos;, event.methodArn));
            break;
        case &apos;unauthorized&apos;:
            callback(&quot;Unauthorized&quot;);   // Return a 401 Unauthorized response
            break;
        default:
            callback(&quot;Error: Invalid token&quot;); // Return a 500 Invalid token response
    }
};

// Help function to generate an IAM policy
var generatePolicy = function(principalId, effect, resource) {
    var authResponse = {};
    
    authResponse.principalId = principalId;
    if (effect &amp;&amp; resource) {
        var policyDocument = {};
        policyDocument.Version = &apos;2012-10-17&apos;; 
        policyDocument.Statement = [];
        var statementOne = {};
        statementOne.Action = &apos;execute-api:Invoke&apos;; 
        statementOne.Effect = effect;
        statementOne.Resource = resource;
        policyDocument.Statement[0] = statementOne;
        authResponse.policyDocument = policyDocument;
    }
    
    // Optional output with custom properties of the String, Number or Boolean type.
    authResponse.context = {
        &quot;stringKey&quot;: &quot;stringval&quot;,
        &quot;numberKey&quot;: 123,
        &quot;booleanKey&quot;: true
    };
    return authResponse;
}</code></pre>
                           </li>
                        <li>
                           
                           <p>Choose <b>Save</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the API Gateway console, create a <a href="api-gateway-create-api-from-example.html">simple API</a>
                              if you don&apos;t already have one.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose your API from the API list.</p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Authorizers</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create New Authorizer</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Enter a name for the authorizer.</p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Type</b>, choose Lambda.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Function</b>, choose the region where you
                              created your Lambda authorizer function and choose the function name from the
                              dropdown list.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Leave <b>Lambda Invoke Role</b> blank.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Event Payload</b>, choose
                              <b>Token</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Token Source</b>, enter
                              <strong class="userinput"><code>tokenHeader</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For the <b>tokenHeader</b> value, enter
                              <strong class="userinput"><code>allow</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>In this example, when the API receives a method request, API Gateway passes the source
                        token to this Lambda authorizer function in the <code class="code">event.authorizationToken</code>
                        attribute. The Lambda authorizer function reads the token and acts as follows:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>If the token value is <code class="code">&apos;allow&apos;</code>, the authorizer function
                                 returns a <code class="code">200 OK</code> HTTP response and an IAM policy that looks
                                 like the following, and the method request succeeds:
                              </p>
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: &quot;execute-api:Invoke&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;arn:aws:execute-api:us-east-1:123456789012:ivdtdhp7b5/ESTestInvoke-stage/GET/&quot;
    }
  ]
}</code></pre>
                              </li>
                           <li class="listitem">
                              
                              <p>If the token value is <code class="code">&apos;deny&apos;</code>, the authorizer function returns
                                 a <code class="code">403 Forbidden</code> HTTP response and a <code class="code">Deny</code> IAM
                                 policy that looks like the following, and the method request fails:
                              </p>
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: &quot;execute-api:Invoke&quot;,
      &quot;Effect&quot;: &quot;Deny&quot;,
      &quot;Resource&quot;: &quot;arn:aws:execute-api:us-east-1:123456789012:ivdtdhp7b5/ESTestInvoke-stage/GET/&quot;
    }
  ]
}</code></pre>
                              </li>
                           <li class="listitem">
                              
                              <p>If the token value is <code class="code">&apos;unauthorized&apos;</code> or an empty string, the
                                 authorizer function returns a <code class="code">401 Unauthorized</code> HTTP response,
                                 and the method call fails.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>If the token is anything else, the client receives a <code class="code">500 Invalid
                                    token</code> response, and the method call fails.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>In production code, you may need to authenticate the user before granting
                           authorization. If so, you can add authentication logic in the Lambda function as
                           well by calling an authentication provider as directed in the documentation for
                           that provider.
                        </p>
                     </div>
                     
                     <p>In addition to returning an IAM policy, the Lambda authorizer function must also
                        return the caller&apos;s principal identifier. It can also optionally return a
                        <code class="code">context</code> object containing additional information that can be passed
                        into the integration backend. For more information, see <a href="api-gateway-lambda-authorizer-output.html">Output from an Amazon API Gateway Lambda
                           Authorizer</a>. 
                     </p>
                     
                     
                     
                     
                     <h3 id="api-gateway-lambda-authorizer-request-lambda-function-create">
                        EXAMPLE: Create a Request-Based Lambda Authorizer Function
                     </h3>
                     
                     <p>To create a request-based Lambda authorizer function, enter the following Node.js
                        8.10 code in the Lambda console and test it in the API Gateway console as follows.
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>In the Lambda console, choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Author from scratch</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Enter a name for the function.</p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Runtime</b>, choose <b>Node.js
                                 8.10</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Copy/paste the following code into the code editor.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">exports.handler = function(event, context, callback) {        
    console.log(&apos;Received event:&apos;, JSON.stringify(event, null, 2));

    // A simple request-based authorizer example to demonstrate how to use request 
    // parameters to allow or deny a request. In this example, a request is  
    // authorized if the client-supplied HeaderAuth1 header, QueryString1 
    // query parameter, and stage variable of StageVar1 all match
    // specified values of &apos;headerValue1&apos;, &apos;queryValue1&apos;, and &apos;stageValue1&apos;,
    // respectively.

    // Retrieve request parameters from the Lambda function input:
    var headers = event.headers;
    var queryStringParameters = event.queryStringParameters;
    var pathParameters = event.pathParameters;
    var stageVariables = event.stageVariables;
        
    // Parse the input for the parameter values
    var tmp = event.methodArn.split(&apos;:&apos;);
    var apiGatewayArnTmp = tmp[5].split(&apos;/&apos;);
    var awsAccountId = tmp[4];
    var region = tmp[3];
    var restApiId = apiGatewayArnTmp[0];
    var stage = apiGatewayArnTmp[1];
    var method = apiGatewayArnTmp[2];
    var resource = &apos;/&apos;; // root resource
    if (apiGatewayArnTmp[3]) {
        resource += apiGatewayArnTmp[3];
    }
        
    // Perform authorization to return the Allow policy for correct parameters and 
    // the &apos;Unauthorized&apos; error, otherwise.
    var authResponse = {};
    var condition = {};
    condition.IpAddress = {};
     
    if (headers.HeaderAuth1 === &quot;headerValue1&quot;
        &amp;&amp; queryStringParameters.QueryString1 === &quot;queryValue1&quot;
        &amp;&amp; stageVariables.StageVar1 === &quot;stageValue1&quot;) {
        callback(null, generateAllow(&apos;me&apos;, event.methodArn));
    }  else {
        callback(&quot;Unauthorized&quot;);
    }
}
     
// Help function to generate an IAM policy
var generatePolicy = function(principalId, effect, resource) {
    // Required output:
    var authResponse = {};
    authResponse.principalId = principalId;
    if (effect &amp;&amp; resource) {
        var policyDocument = {};
        policyDocument.Version = &apos;2012-10-17&apos;; // default version
        policyDocument.Statement = [];
        var statementOne = {};
        statementOne.Action = &apos;execute-api:Invoke&apos;; // default action
        statementOne.Effect = effect;
        statementOne.Resource = resource;
        policyDocument.Statement[0] = statementOne;
        authResponse.policyDocument = policyDocument;
    }
    // Optional output with custom properties of the String, Number or Boolean type.
    authResponse.context = {
        &quot;stringKey&quot;: &quot;stringval&quot;,
        &quot;numberKey&quot;: 123,
        &quot;booleanKey&quot;: true
    };
    return authResponse;
}
     
var generateAllow = function(principalId, resource) {
    return generatePolicy(principalId, &apos;Allow&apos;, resource);
}
     
var generateDeny = function(principalId, resource) {
    return generatePolicy(principalId, &apos;Deny&apos;, resource);
}</code></pre>
                           </li>
                        <li>
                           
                           <p>Choose <b>Save</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the API Gateway console, create a <a href="api-gateway-create-api-from-example.html">simple API</a>
                              if you don&apos;t already have one.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose your API from the API list.</p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Authorizers</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create New Authorizer</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Enter a name for the authorizer.</p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Type</b>, choose Lambda.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Function</b>, choose the region where you
                              created your Lambda authorizer function and choose the function name from the
                              dropdown list.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Leave <b>Lambda Invoke Role</b> blank.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Lambda Event Payload</b>, choose
                              <b>Request</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Identity Sources</b>, add a
                              <b>Header</b> named <strong class="userinput"><code>HeaderAuth1</code></strong>, a
                              <b>Query String</b> named
                              <strong class="userinput"><code>QueryString1</code></strong>, and a <b>Stage
                                 Variable</b> named <strong class="userinput"><code>StageVar1</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>HeaderAuth1</b>, enter
                              <strong class="userinput"><code>headerValue1</code></strong>. For
                              <b>QueryString1</b>, enter
                              <strong class="userinput"><code>queryValue1</code></strong>. For <b>StageVar1</b>,
                              enter <strong class="userinput"><code>stageValue1</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p>In this example, the Lambda authorizer function checks the input parameters and
                        acts as follows:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>If all the required parameter values match the expected values, the
                                 authorizer function returns a <code class="code">200 OK</code> HTTP response and an IAM
                                 policy that looks like the following, and the method request
                                 succeeds:
                              </p>
                              <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Action&quot;: &quot;execute-api:Invoke&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Resource&quot;: &quot;arn:aws:execute-api:us-east-1:123456789012:ivdtdhp7b5/ESTestInvoke-stage/GET/&quot;
    }
  ]
}</code></pre>
                              </li>
                           <li class="listitem">
                              
                              <p>Otherwise, the the authorizer function returns a <code class="code">401
                                    Unauthorized</code> HTTP response, and the method call fails.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>In production code, you may need to authenticate the user before granting
                           authorization. If so, you can add authentication logic in the Lambda function as
                           well by calling an authentication provider as directed in the documentation for
                           that provider.
                        </p>
                     </div>
                     
                     <p>In addition to returning an IAM policy, the Lambda authorizer function must also
                        return the caller&apos;s principal identifier. It can also optionally return a
                        <code class="code">context</code> object containing additional information that can be passed
                        into the integration backend. For more information, see <a href="api-gateway-lambda-authorizer-output.html">Output from an Amazon API Gateway Lambda
                           Authorizer</a>. 
                     </p>
                     
                     
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-control-access-tags.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="configure-api-gateway-lambda-authorization-with-console.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Lambda Authorizer Auth
                Workflow"><a class="pagetoc" href="#api-gateway-lambda-authorizer-flow">Lambda Authorizer Auth
                              Workflow</a></li>
                        <li class="pagetoc" name="Steps to Create an API Gateway Lambda
                Authorizer"><a class="pagetoc" href="#api-gateway-lambda-authorizer-create">Steps to Create a Lambda Authorizer</a></li>
                        <li class="pagetoc" name="Create an API Gateway
                Lambda Authorizer Function in the Lambda Console"><a class="pagetoc" href="#api-gateway-lambda-authorizer-lambda-function-create">Create a Lambda Authorizer Function in the Lambda Console</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>