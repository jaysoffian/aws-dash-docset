<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Configuring AWS X-Ray Sampling
         Rules for API Gateway APIs - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-xray.html" title="Trace API Gateway API Execution with AWS X-Ray">
      <link rel="prev" href="apigateway-using-xray-maps.html" title="Using AWS X-Ray Service Maps and Trace Views
            with API Gateway">
      <link rel="next" href="apigateway-understanding-xray-traces.html" title="Understanding AWS X-Ray Traces for
            Amazon API Gateway APIs">
      <meta name="description" content="Learn how to configure AWS X-Ray sampling rules.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-configuring-xray-sampling-rules.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/apigateway/index.html">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-rest-api.html">Creating, Deploying, and Invoking a REST API
                                    in Amazon API Gateway</a> &#xBB; <a href="monitoring_overview.html">Tracing, Logging, and Monitoring an API Gateway API</a> &#xBB; <a href="apigateway-xray.html">Trace API Gateway API Execution with AWS X-Ray</a> &#xBB; <span class="breadcrumb">Configuring AWS X-Ray Sampling
                                    Rules for API Gateway APIs</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-configuring-xray-sampling-rules">Configuring AWS X-Ray Sampling
                        Rules for API Gateway APIs
                     </h1>
                     <p>You can use AWS X-Ray console or SDK to configure sampling rules for your Amazon API
                        Gateway API.
                        A sampling rule specifies which requests X-Ray should record for your API. By customizing
                        sampling rules, you can control the amount of data that you record, and modify sampling
                        behavior on the fly without modifying or redeploying your code.
                     </p>
                     <p>Before you specify your X-Ray sampling rules, read the following topics in the X-Ray
                        Developer Guide:
                     </p>
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><a href="./xray/latest/devguide/xray-console-sampling.html">Configuring Sampling Rules
                                    in the AWS X-Ray Console</a></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><a href="./xray/latest/devguide/xray-api-sampling.html">Using Sampling Rules with the X-Ray
                                    API</a></p>
                              
                           </li>
                        </ul>
                     </div>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#apigateway-xray-sampling-rule-options">X-Ray Sampling Rule Option
                                 Values for API Gateway APIs</a></li>
                           <li><a href="#apigateway-xray-sampling-rules-examples">X-Ray Sampling Rule
                                 Examples</a></li>
                        </ul>
                     </div>
                     
                     <h2 id="apigateway-xray-sampling-rule-options">X-Ray Sampling Rule Option
                        Values for API Gateway APIs
                     </h2>
                     
                     <p>The following X-Ray sampling options are relevant for API Gateway. String values can
                        use
                        wildcards to match a single character (?) or zero or more characters (*). For more
                        details, including a detailed explanation of how the <b>Reservoir</b> and <b>Rate</b> settings are used,
                        <a href="./xray/latest/devguide/xray-console-sampling.html">Configuring Sampling Rules in
                           the AWS X-Ray Console</a>.
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><b>Rule name</b> (string) &#x2014; A unique name for
                                 the rule.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Priority</b> (integer between 1 and 9999)
                                 &#x2014; The priority of the sampling rule. Services evaluate rules in ascending
                                 order of priority, and make a sampling decision with the first rule that
                                 matches.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Reservoir</b> (nonnegative integer) &#x2014; A
                                 fixed number of matching requests to instrument per second, before applying the
                                 fixed rate. The reservoir is not used directly by services, but applies to all
                                 services using the rule collectively.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Rate</b> (number between 0 and 100) &#x2014; The
                                 percentage of matching requests to instrument, after the reservoir is
                                 exhausted.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service name</b> (string) &#x2014; API stage
                                 name, in the form
                                 <strong class="userinput"><code><em class="replaceable"><code>{api-name}</code></em>/<em class="replaceable"><code>{stage-name}</code></em></code></strong>.
                                 For example, if you were to deploy the <a href="api-gateway-create-api-from-example.html">PetStore</a> sample
                                 API to a stage named <code class="code">test</code>, the <b>Service name</b>
                                 value to specify in your sampling rule would be
                                 <strong class="userinput"><code>pets/test</code></strong>.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service type</b> (string) &#x2014; For an API Gateway
                                 API, either <strong class="userinput"><code>AWS::ApiGateway::Stage</code></strong> or
                                 <strong class="userinput"><code>AWS::ApiGateway::*</code></strong> can be specified.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Host</b> (string) &#x2014; The hostname from the
                                 HTTP host header. Set this to <strong class="userinput"><code>*</code></strong> to match against all
                                 hostnames. Or you can specify a full or partial hostname to match, for example,
                                 <strong class="userinput"><code>api.example.com</code></strong> or
                                 <strong class="userinput"><code>*.example.com</code></strong>.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Resource ARN</b> (string) &#x2014; The ARN of the
                                 API stage, in the format
                                 <strong class="userinput"><code>arn:aws:execute-api:<em class="replaceable"><code>{region}</code></em>:<em class="replaceable"><code>{account-id}</code></em>:<em class="replaceable"><code>{api-id}</code></em>/<em class="replaceable"><code>{stage-name}</code></em></code></strong>,
                                 for example,
                                 <strong class="userinput"><code>arn:aws:execute-api:us-east-1:123456789012:qsxrty/test</code></strong>.
                              </p>
                              
                              <p>The stage name can be obtained from the console or the API Gateway CLI or API. For
                                 more information about ARN formats, see the <a href="./general/latest/gr/">Amazon Web Services General Reference</a>.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>HTTP method</b> (string) &#x2014; The method to
                                 be sampled, for example, <strong class="userinput"><code>GET</code></strong>.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              
                              <p><b>URL path</b> (string) &#x2014; This option is not
                                 supported for API Gateway.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>(optional) <b>Attributes</b> (key and value)
                                 &#x2014; Headers from the original HTTP request, for example,
                                 <strong class="userinput"><code>Connection</code></strong>, <strong class="userinput"><code>Content-Length</code></strong>, or
                                 <strong class="userinput"><code>Content-Type</code></strong>. Each attribute value can be up to 32
                                 characters long.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <h2 id="apigateway-xray-sampling-rules-examples">X-Ray Sampling Rule
                        Examples
                     </h2>
                     
                     <p><b>Sampling Rule Example #1</b></p>
                     
                     <p>This rule samples all <code class="code">GET</code> requests for the <code class="code">testxray</code> API at
                        the <code class="code">test</code> stage.
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><b>Rule name &#x2014;
                                    </b><strong class="userinput"><code>test-sampling</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Priority &#x2014;
                                    </b><strong class="userinput"><code>17</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Reservoir size &#x2014;
                                    </b><strong class="userinput"><code>10</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Fixed rate &#x2014;
                                    </b><strong class="userinput"><code>10</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service name &#x2014;
                                    </b><strong class="userinput"><code>testxray/test</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service type &#x2014;
                                    </b><strong class="userinput"><code>AWS::ApiGateway::Stage</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>HTTP method &#x2014;
                                    </b><strong class="userinput"><code>GET</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Resource ARN &#x2014;
                                    </b><strong class="userinput"><code>*</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Host &#x2014; </b><strong class="userinput"><code>*</code></strong></p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <p><b>Sampling Rule Example #2</b></p>
                     
                     <p>This rule samples all requests for the <code class="code">testxray</code> API at the
                        <code class="code">prod</code> stage.
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><b>Rule name &#x2014;
                                    </b><strong class="userinput"><code>prod-sampling</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Priority &#x2014;
                                    </b><strong class="userinput"><code>478</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Reservoir size &#x2014;
                                    </b><strong class="userinput"><code>1</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Fixed rate &#x2014;
                                    </b><strong class="userinput"><code>60</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service name &#x2014;
                                    </b><strong class="userinput"><code>testxray/prod</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Service type &#x2014;
                                    </b><strong class="userinput"><code>AWS::ApiGateway::Stage</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>HTTP method &#x2014;
                                    </b><strong class="userinput"><code>*</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Resource ARN &#x2014;
                                    </b><strong class="userinput"><code>*</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Host &#x2014; </b><strong class="userinput"><code>*</code></strong></p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><b>Attributes</b> &#x2014;
                                 <strong class="userinput"><code>{}</code></strong></p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-using-xray-maps.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="apigateway-understanding-xray-traces.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="X-Ray Sampling Rule Option
                Values for API Gateway APIs"><a class="pagetoc" href="#apigateway-xray-sampling-rule-options">X-Ray Sampling Rule Option
                              Values for API Gateway APIs</a></li>
                        <li class="pagetoc" name="X-Ray Sampling Rule
                Examples"><a class="pagetoc" href="#apigateway-xray-sampling-rules-examples">X-Ray Sampling Rule
                              Examples</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>