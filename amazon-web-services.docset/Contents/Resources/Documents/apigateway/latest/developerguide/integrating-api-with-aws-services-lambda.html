<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>TUTORIAL: Create a
         Calc REST API with Two AWS Service Integrations and and One Lambda Non-Proxy Integration - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="api-gateway-tutorials.html" title="Amazon API Gateway Tutorials">
      <link rel="prev" href="getting-started-aws-proxy.html" title="TUTORIAL: Build an API Gateway API with AWS Integration">
      <link rel="next" href="api-as-lambda-proxy-export-swagger-with-extensions.html" title="">
      <meta name="description" content="Learn two ways to configure a REST API in Amazon API Gateway as a service proxy for AWS Lambda.">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/integrating-api-with-aws-services-lambda.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/apigateway/index.html">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="api-gateway-tutorials.html">Amazon API Gateway Tutorials</a> &#xBB; <span class="breadcrumb">TUTORIAL: Create a
                                    Calc REST API with Two AWS Service Integrations and and One Lambda Non-Proxy Integration</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="integrating-api-with-aws-services-lambda">TUTORIAL: Create a
                        <code class="code">Calc</code> REST API with Two AWS Service Integrations and and One Lambda Non-Proxy Integration
                     </h1>
                     <p>The <a href="getting-started-lambda-non-proxy-integration.html">Getting Started non-proxy
                           integration tutorial</a> uses <code class="code">Lambda Function</code> integration exclusively.
                        <code class="code">Lambda Function</code> integration is a special case of the <code class="code">AWS
                           Service</code> integration type that performs much of the integration setup for you,
                        such as automatically adding the required resource-based permissions for invoking
                        the Lambda
                        function. Here, two of the three integrations use <code class="code">AWS Service</code> integration. In
                        this integration type, you have more control, but you&apos;ll need to manually perform
                        tasks like
                        creating and specifying an IAM role containing appropriate permissions.
                     </p>
                     <p>In this tutorial, you&apos;ll create a <code class="code">Calc</code> Lambda function that implements basic
                        arithmetic operations, accepting and returning JSON-formatted input and output. Then
                        you&apos;ll
                        create a REST API and integrate it with the Lambda function in the following ways:
                     </p>
                     <ol>
                        <li>
                           
                           <p>By exposing a <code class="code">GET</code> method on the <code class="code">/calc</code> resource to invoke
                              the Lambda function, supplying the input as query string parameters. (<code class="code">AWS
                                 Service</code> integration)
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>By exposing a <code class="code">POST</code> method on the <code class="code">/calc</code> resource to
                              invoke the Lambda function, supplying the input in the method request payload.
                              (<code class="code">AWS Service</code> integration)
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>By exposing a <code class="code">GET</code> on nested
                              <code class="code">/calc/{operand1}/{operand2}/{operator}</code> resources to invoke the
                              Lambda function, supplying the input as path parameters. (<code class="code">Lambda Function</code>
                              integration)
                           </p>
                           
                        </li>
                     </ol>
                     <p>In addition to trying out this tutorial, you may wish to study the <a href="api-as-lambda-proxy-export-swagger-with-extensions.html">OpenAPI definition
                           file</a> for the <code class="code">Calc</code> API, which you can import into API Gateway by following
                        the instructions in <a href="api-gateway-import-api.html">Import a REST API into API Gateway</a>.
                     </p>
                     <div class="highlights">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#w20aac11c17c15">Create an AWS Account</a></li>
                           <li><a href="#api-as-lambda-proxy-setup-iam-role-policies">Create an Assumable IAM
                                 Role</a></li>
                           <li><a href="#api-as-lambda-proxy-create-lambda-function">Create a Calc
                                 Lambda Function</a></li>
                           <li><a href="#api-as-lambda-proxy-create-lambda-function">Test the Calc
                                 Lambda Function</a></li>
                           <li><a href="#api-as-lambda-proxy-create-api-resources">Create a Calc
                                 API</a></li>
                           <li><a href="#api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function">Integration 1: Create a GET Method with Query Parameters to Call the
                                 Lambda Function</a></li>
                           <li><a href="#api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function">Integration 2: Create a POST Method with a JSON Payload to Call the
                                 Lambda Function</a></li>
                           <li><a href="#api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function">Integration 3: Create a GET Method with Path Parameters to Call the
                                 Lambda Function</a></li>
                           <li><a href="api-as-lambda-proxy-export-swagger-with-extensions.html">OpenAPI Definitions of Sample API Integrated with a Lambda Function</a></li>
                        </ul>
                     </div>
                     
                     <h2 id="w20aac11c17c15">Create an AWS Account</h2>
                     
                     <p>Before you begin this tutorial, you&apos;ll need an AWS account. </p> 
                     
                     
                     <p>If you do not have an AWS account, complete the following steps to create one.</p>
                     
                     <p class="title"><b>To sign up for an AWS account</b></p>
                     <ol>
                        <li>
                           <p>Open <a href="https://portal.aws.amazon.com/billing/signup" target="_blank">https://portal.aws.amazon.com/billing/signup</a>.
                           </p>
                           
                        </li>
                        <li>
                           <p>Follow the online instructions.</p>
                           
                           <p>Part of the sign-up procedure involves receiving a phone call and entering 
                              a verification code on the phone keypad.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-setup-iam-role-policies">Create an Assumable IAM
                        Role
                     </h2>
                     
                     
                     <p>In order for your API to invoke your <code class="code">Calc</code> Lambda function, you&apos;ll need to
                        have an API Gateway assumable IAM role, which is an IAM role with the following trusted
                        relationship:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: &quot;apigateway.amazonaws.com&quot;
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}</code></pre>
                     <p>The role you create will need to have Lambda <a href="./lambda/latest/dg/API_Invoke.html">InvokeFunction</a> permission. Otherwise, the API caller will receive a
                        <code class="code">500 Internal Server Error</code> response. To give the role this permission,
                        you&apos;ll attach the following IAM policy to it:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;lambda:InvokeFunction&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}</code></pre>
                     <p>Here&apos;s how to accomplish all this:</p>
                     
                     <p class="title"><b>Create an API Gateway assumable IAM role</b></p>
                     <ol>
                        <li>
                           
                           <p>Log in to to the IAM console.</p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Roles</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Role</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Select type of trusted entity</b>, choose
                              <b>AWS Service</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Choose the service that will use this role</b>, choose
                              <b>Lambda</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Next: Permissions</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Policy</b>.
                           </p>
                           
                           <p>A new <b>Create Policy</b> console window will open up. In that
                              window, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>In the <b>JSON</b> tab, replace the existing policy with
                                    the following:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;lambda:InvokeFunction&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}                        
        </code></pre>
                                 </li>
                              <li>
                                 
                                 <p>Choose <b>Review policy</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Under <b>Review Policy</b>, do the following:
                                 </p>
                                 
                                 <ol>
                                    <li>
                                       
                                       <p>For <b>Name</b>, type a name such as
                                          <strong class="userinput"><code>lambda_execute</code></strong>.
                                       </p>
                                       
                                    </li>
                                    <li>
                                       
                                       <p>Choose <b>Create Policy</b>.
                                       </p>
                                       
                                    </li>
                                 </ol>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>In the original <b>Create Role</b> console window, do the
                              following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Under <b>Attach permissions policies</b>, choose your
                                    <strong class="userinput"><code>lambda_execute</code></strong> policy from the dropdown
                                    list.
                                 </p>
                                 
                                 <p>If you don&apos;t see your policy in the list, choose the refresh button at
                                    the top of the list. (Don&apos;t refresh the browser page!)
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Next:Tags</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Next:Review</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For the <b>Role name</b>, type a name such as
                                    <strong class="userinput"><code>lambda_invoke_function_assume_apigw_role</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Create role</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose your <strong class="userinput"><code>lambda_invoke_function_assume_apigw_role</code></strong>
                              from the list of roles.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>Trust relationships</b> tab.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Edit trust relationship</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Replace the existing policy with the following:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      &quot;Sid&quot;: &quot;&quot;,
      &quot;Effect&quot;: &quot;Allow&quot;,
      &quot;Principal&quot;: {
        &quot;Service&quot;: [
          &quot;lambda.amazonaws.com&quot;,
          &quot;apigateway.amazonaws.com&quot;
        ]
      },
      &quot;Action&quot;: &quot;sts:AssumeRole&quot;
    }
  ]
}                        
        </code></pre>
                           </li>
                        <li>
                           
                           <p>Choose <b>Update Trust Policy</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Make a note of the role ARN for the role you just created. You&apos;ll need it
                              later.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-create-lambda-function">Create a <code class="code">Calc</code>
                        Lambda Function
                     </h2>
                     
                     
                     <p>Next you&apos;ll create a Lambda function using the Lambda console.</p>
                     
                     <ol>
                        <li>
                           
                           <p>In the Lambda console, choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Author from Scratch</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Name</b>, type <strong class="userinput"><code>Calc</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Set the <b>Runtime</b> to <b>Node.js
                                 8.10</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p> Copy the following Lambda function and paste it into the code editor in the
                              Lambda console. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">console.log(&apos;Loading the Calc function&apos;);

exports.handler = function(event, context, callback) {
    console.log(&apos;Received event:&apos;, JSON.stringify(event, null, 2));
    if (event.a === undefined || event.b === undefined || event.op === undefined) {
        callback(&quot;400 Invalid Input&quot;);
    }
    
    var res = {};
    res.a = Number(event.a);
    res.b = Number(event.b);
    res.op = event.op;
    
    if (isNaN(event.a) || isNaN(event.b)) {
        callback(&quot;400 Invalid Operand&quot;);
    }

    switch(event.op)
    {
        case &quot;+&quot;:
        case &quot;add&quot;:
            res.c = res.a + res.b;
            break;
        case &quot;-&quot;:
        case &quot;sub&quot;:
            res.c = res.a - res.b;
            break;
        case &quot;*&quot;:
        case &quot;mul&quot;:
            res.c = res.a * res.b;
            break;
        case &quot;/&quot;:
        case &quot;div&quot;:
            res.c = res.b===0 ? NaN : Number(event.a) / Number(event.b);
            break;
        default:
            callback(&quot;400 Invalid Operator&quot;);
            break;
    }
    callback(null, res);
};</code></pre>
                           </li>
                        <li>
                           
                           <p>Under Execution role, choose <b>Choose an existing
                                 role</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Enter the role ARN for the
                              <strong class="userinput"><code>lambda_invoke_function_assume_apigw_role</code></strong> role you
                              created earlier.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Save</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p> This function requires two operands (<code class="code">a</code> and <code class="code">b</code>) and an
                        operator (<code class="code">op</code>) from the <code class="code">event</code> input parameter. The input is a
                        JSON object of the following format: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: &quot;Number&quot; | &quot;String&quot;,
  &quot;b&quot;: &quot;Number&quot; | &quot;String&quot;,
  &quot;op&quot;: &quot;String&quot;
}
        </code></pre>
                     <p>This function returns the calculated result (<code class="code">c</code>) and the input. For an
                        invalid input, the function returns either the null value or the &quot;Invalid op&quot; string
                        as
                        the result. The output is of the following JSON format: 
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: &quot;Number&quot;,
  &quot;b&quot;: &quot;Number&quot;,
  &quot;op&quot;: &quot;String&quot;,
  &quot;c&quot;: &quot;Number&quot; | &quot;String&quot;
}
        </code></pre>
                     <p>You should test the function in the Lambda console before integrating it with the
                        API
                        in the next step. 
                     </p>
                     
                     
                     <h2 id="api-as-lambda-proxy-create-lambda-function">Test the <code class="code">Calc</code>
                        Lambda Function
                     </h2>
                     
                     <p>Here&apos;s how to test your <code class="code">Calc</code> function in the Lambda console:
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>In the <b>Saved test events</b> dropdown menu, choose
                              <b>Configure test events</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For the test event name, enter <strong class="userinput"><code>calc2plus5</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Replace the test event definition with the following:</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: &quot;2&quot;,
  &quot;b&quot;: &quot;5&quot;,
  &quot;op&quot;: &quot;+&quot;
}
        </code></pre>
                           </li>
                        <li>
                           
                           <p>Choose <b>Save</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Expand <b>Execution result: succeeded</b>. You should see the
                              following:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: 2,
  &quot;b&quot;: 5,
  &quot;op&quot;: &quot;+&quot;,
  &quot;c&quot;: 7
}
        </code></pre>
                           </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-create-api-resources">Create a <code class="code">Calc</code>
                        API
                     </h2>
                     
                     
                     <p>The following procedure shows how to create an API for the <code class="code">Calc</code> Lambda
                        function you just created. In subsequent sections, you&apos;ll add resources and methods
                        to
                        it.
                     </p>
                     
                     <p class="title"><b>Create the <code class="code">Calc</code> API</b></p>
                     <ol>
                        <li>
                           
                           <p>In the API Gateway console, choose <b>Create API</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>API Name</b>, type
                              <strong class="userinput"><code>LambdaCalc</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Leave the <b>Description</b> blank, and leave the
                              <b>Endpoint Type</b> set to
                              <b>Regional</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create API</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function">Integration 1: Create a <code class="code">GET</code> Method with Query Parameters to Call the
                        Lambda Function
                     </h2>
                     
                     
                     <p>By creating a <code class="code">GET</code> method that passes query string parameters to the Lambda
                        function, you enable the API to be invoked from a browser. This approach can be useful,
                        especially for APIs that allow open access.
                     </p>
                     
                     <p class="title"><b>To set up the <code class="code">GET</code> method with query string parameters</b></p>
                     <ol>
                        <li>
                           
                           <p>In the API Gateway console, under your <code class="code">LambdaCalc</code> API&apos;s
                              <b>Resources</b>, choose <b>/</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Actions</b> drop-down menu, choose <b>Create
                                 Resource</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Name</b>, enter
                              <strong class="userinput"><code>calc</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>/calc</b> resource you just created.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Actions</b> drop-down menu, choose <b>Create
                                 Method</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the method drop-down menu that appears, choose
                              <b>GET</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the checkmark icon to save your choice.</p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Set up</b> pane:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Integration type</b>, choose <b>AWS
                                       Service</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>AWS Region</b>, choose the region (e.g.,
                                    <code class="code">us-west-2</code>) where you created the Lambda function.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>AWS Service</b>, choose
                                    <b>Lambda</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>AWS Subdomain</b> blank, because our Lambda
                                    function is not hosted on any AWS subdomain.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>HTTP method</b>, choose
                                    <b>POST</b> and choose the checkmark icon to
                                    save your choice. Lambda requires that the <code class="code">POST</code> request be
                                    used to invoke any Lambda function. This example shows that the HTTP
                                    method in a frontend method request can be different from the
                                    integration request in the backend.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <code class="code">Use path override</code> for <b>Action
                                       Type</b>. This option allows us to specify the ARN of the
                                    <a href="./lambda/latest/dg/API_Invoke.html">Invoke</a> action to
                                    execute our <code class="code">Calc</code> function.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Enter
                                    <code class="code">/2015-03-31/functions/arn:aws:lambda:<em class="replaceable"><code>region</code></em>:<em class="replaceable"><code>account-id</code></em>:function:Calc/invocations</code>
                                    in <b>Path override</b>, where
                                    <em class="replaceable"><code>region</code></em> is the region where you created
                                    your Lambda function and <em class="replaceable"><code>account-id</code></em> is the
                                    account number for the AWS account.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Execution role</b>, enter the role ARN for the
                                    <strong class="userinput"><code>lambda_invoke_function_assume_apigw_role</code></strong>
                                    IAM role you created <a href="integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-setup-iam-role-policies">earlier</a>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>Content Handling</b> set to
                                    <b>Passthrough</b>, because this method will not
                                    deal with any binary data.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>Use default timeout</b> checked.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Method Request</b>.
                           </p>
                           
                           <p>Now you will set up query parameters for the <b>GET</b> method
                              on <b>/calc</b> so it can receive input on behalf of the backend
                              Lambda function.
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose the pencil icon next to <b>Request Validator</b>
                                    and choose <b>Validate query string parameters and
                                       headers</b> from the drop-down menu. This setting will
                                    cause an error message to return to state the required parameters are
                                    missing if the client does not specify them. You will not get charged
                                    for the call to the backend.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the checkmark icon to save your changes.</p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Expand the <b>URL Query String Parameters</b> section.
                                    
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Add query string</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Name</b>, type
                                    <strong class="userinput"><code>operand1</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the checkmark icon to save the parameter.</p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Repeat the previous steps to create parameters named
                                    <strong class="userinput"><code>operand2</code></strong> and
                                    <strong class="userinput"><code>operator</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Check the <b>Required</b> option for each parameter to
                                    ensure that they are validated.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Method Execution</b> and then choose
                              <b>Integration Request</b> to set up the mapping template to
                              translate the client-supplied query strings to the integration request payload
                              as required by the <code class="code">Calc</code> function.
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Expand the <b>Mapping Templates</b> section.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>When no template matches the request Content-Type
                                       header</b> for <b>Request body
                                       passthrough</b>. 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Under <b>Content-Type</b>, choose <b>Add mapping
                                       template</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <strong class="userinput"><code>application/json</code></strong> and choose the checkmark
                                    icon to open the template editor.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Yes, secure this integration</b> to
                                    proceed.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Copy the following mapping script into the mapping template editor: </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;a&quot;:  &quot;$input.params(&apos;operand1&apos;)&quot;,
    &quot;b&quot;:  &quot;$input.params(&apos;operand2&apos;)&quot;, 
    &quot;op&quot;: &quot;$input.params(&apos;operator&apos;)&quot;   
}</code></pre>
                                 <p> This template maps the three query string parameters declared in
                                    <b>Method Request</b> into designated property values
                                    of the JSON object as the input to the backend Lambda function. The
                                    transformed JSON object will be included as the integration request
                                    payload. 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Method Execution</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>You can now test your <code class="code">GET</code> method to verify that it has been
                              properly set up to invoke the Lambda function:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Query Strings</b>, type
                                    <strong class="userinput"><code>operand1=2&amp;operand2=3&amp;operator=+</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>.
                                 </p>
                                 
                                 <p>The results should look similar to this:</p>
                                 
                                 <div class="mediaobject">
                                    
                                    <img src="../../..//img/aws_proxy_lambda_calc_get_method_test.png" alt="
                                Create an API in API Gateway as a Lambda proxy
                            " style="max-width:100%">
                                    
                                    
                                    
                                 </div>
                                 
                              </li>
                           </ol>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function">Integration 2: Create a <code class="code">POST</code> Method with a JSON Payload to Call the
                        Lambda Function
                     </h2>
                     
                     
                     <p>By creating a <code class="code">POST</code> method with a JSON payload to call the Lambda function,
                        you make it so that the client must provide the necessary input to the backend function
                        in the request body. To ensure that the client uploads the correct input data, you&apos;ll
                        enable request validation on the payload.
                     </p>
                     
                     <p class="title"><b>To set up the <code class="code">POST</code> method with a JSON payload to invoke a Lambda
                           function</b></p>
                     <ol>
                        <li>
                           
                           <p>Go to the API Gateway console.</p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>APIs</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>LambdaCalc</b> API you created previously.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>/calc</b> resource from
                              <b>Resources</b> pane.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Actions</b> menu, choose <b>Create
                                 Method</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>POST</b> from the method drop-down list.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the checkmark icon to save your choice.</p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Set up</b> pane:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Integration type</b>, choose <b>AWS
                                       Service</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>AWS Region</b>, choose the region (e.g.,
                                    <code class="code">us-west-2</code>) where you created the Lambda function.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>AWS Service</b>, choose
                                    <b>Lambda</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>AWS Subdomain</b> blank, because our Lambda
                                    function is not hosted on any AWS subdomain.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>HTTP method</b>, choose
                                    <b>POST</b>. This example shows that the HTTP
                                    method in a frontend method request can be different from the
                                    integration request in the backend.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Action</b>, choose <code class="code">Use path override</code>
                                    for <b>Action Type</b>. This option allows you to specify
                                    the ARN of the <a href="./lambda/latest/dg/API_Invoke.html">Invoke</a>
                                    action to execute your <code class="code">Calc</code> function.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Path override</b>, type
                                    <code class="code">/2015-03-31/functions/arn:aws:lambda:<em class="replaceable"><code>region</code></em>:<em class="replaceable"><code>account-id</code></em>:function:Calc/invocations</code>
                                    , where <em class="replaceable"><code>region</code></em> is the region where you
                                    created your Lambda function and <em class="replaceable"><code>account-id</code></em> is
                                    the account number for the AWS account.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Execution role</b>, enter the role ARN for the
                                    <strong class="userinput"><code>lambda_invoke_function_assume_apigw_role</code></strong>
                                    IAM role you created <a href="integrating-api-with-aws-services-lambda.html#api-as-lambda-proxy-setup-iam-role-policies">earlier</a>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>Content Handling</b> set to
                                    <b>Passthrough</b>, because this method will not
                                    deal with any binary data.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave <b>Use Default Timeout</b> checked.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Models</b> under your <b>LambdaCalc</b>
                              API in the API Gateway console&apos;s primary navigation pane to create data models for
                              the
                              method&apos;s input and output:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Create</b> in the <b>Models</b>
                                    pane. Type <code class="code">Input</code> in <b>Model name</b>, type
                                    <code class="code">application/json</code> in <b>Content type</b>,
                                    and copy the following schema definition into the <b>Model
                                       schema</b> box: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;a&quot;:{&quot;type&quot;:&quot;number&quot;},
        &quot;b&quot;:{&quot;type&quot;:&quot;number&quot;},
        &quot;op&quot;:{&quot;type&quot;:&quot;string&quot;}
    },
    &quot;title&quot;:&quot;Input&quot;
}</code></pre>
                                 <p>This model describes the input data structure and will be used to
                                    validate the incoming request body.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Create model</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Create</b> in the <b>Models</b>
                                    pane. Type <code class="code">Output</code> in <b>Model name</b>, type
                                    <code class="code">application/json</code> in <b>Content type</b>,
                                    and copy the following schema definition into the <b>Model
                                       schema</b> box: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;c&quot;:{&quot;type&quot;:&quot;number&quot;}
    },
    &quot;title&quot;:&quot;Output&quot;
}</code></pre>
                                 <p>This model describes the data structure of the calculated output from
                                    the backend. It can be used to map the integration response data to a
                                    different model. This tutorial relies on the passthrough behavior and
                                    does not use this model.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Locate the API ID for your API at the top of the console screen and
                                    make a note of it. It will appear in parentheses after the API
                                    name.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>In the <b>Models</b> pane, choose
                                    <b>Create</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <code class="code">Result</code> in <b>Model name</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <code class="code">application/json</code> in <b>Content
                                       type</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Copy the following schema definition, where
                                    <em class="replaceable"><code>restapi-id</code></em> is the REST API ID you noted
                                    earlier, into the <b>Model schema</b> box: 
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;type&quot;:&quot;object&quot;,
    &quot;properties&quot;:{
        &quot;input&quot;:{
            &quot;$ref&quot;:&quot;https://apigateway.amazonaws.com/restapis/<em class="replaceable"><code>restapi-id</code></em>/models/Input&quot;
        },
        &quot;output&quot;:{
            &quot;$ref&quot;:&quot;https://apigateway.amazonaws.com/restapis/<em class="replaceable"><code>restapi-id</code></em>/models/Output&quot;
        }
    },
    &quot;title&quot;:&quot;Output&quot;
}</code></pre>
                                 <p>This model describes the data structure of the returned response data.
                                    It references both the <code class="code">Input</code> and <code class="code">Output</code>
                                    schemas defined in the specified API
                                    (<code class="code"><em class="replaceable"><code>restapi-id</code></em></code>). Again,
                                    this model is not used in this tutorial because it leverages the
                                    passthrough behavior.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Create model</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>In the main navigation pane, under your <code class="code">LambdaCalc</code> API, choose
                              <b>Resources</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Resources</b> pane, choose the <code class="code">POST</code>
                              method for your API.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Method Request</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Method Request</b> configuration settings, do the
                              following to enable request validation on the incoming request body:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose the pencil icon next to <b>Request Validator</b>
                                    to choose <code class="code">Validate body</code>. Choose the checkmark icon to save
                                    your choice.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Expand the <b>Request Body</b> section, choose
                                    <b>Add model</b></p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <code class="code">application/json</code> in the
                                    <b>Content-Type</b> input field and choose
                                    <code class="code">Input</code> from the drop-down list in the <b>Model
                                       name</b> column. Choose the checkmark icon to save your
                                    choice.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>To test your <code class="code">POST</code> method, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Method Execution</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Copy the following JSON payload into the <b>Request Body</b>: 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
    &quot;a&quot;: 1,
    &quot;b&quot;: 2,
    &quot;op&quot;: &quot;+&quot;
}
                </code></pre>
                           </li>
                        <li>
                           
                           <p>Choose <b>Test</b>.
                           </p>
                           
                           <p>You should see the following output in <b>Response
                                 Body</b>:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">
{
  &quot;a&quot;: 1,
  &quot;b&quot;: 2,
  &quot;op&quot;: &quot;+&quot;,
  &quot;c&quot;: 3
}                    
                </code></pre>
                           </li>
                     </ol>
                     
                     
                     <h2 id="api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function">Integration 3: Create a <code class="code">GET</code> Method with Path Parameters to Call the
                        Lambda Function
                     </h2>
                     
                     
                     <p>Now you&apos;ll create a <code class="code">GET</code> method on a resource specified by a sequence of
                        path parameters to call the backend Lambda function. The path parameter values specify
                        the input data to the Lambda function. You&apos;ll a mapping template to map the incoming
                        path
                        parameter values to the required integration request payload.
                     </p>
                     
                     <p>This time you&apos;ll use the built-in Lambda integration support in the API Gateway console
                        to
                        set up the method integration.
                     </p>
                     
                     <p>The resulting API resource structure will look like this:</p>
                     
                     <div class="mediaobject">
                        
                        <img src="../../..//img/aws_proxy_lambda_create_api_resources.png" alt="
                Create an API in API Gateway as a Lambda proxy
            " style="max-width:100%">
                        
                        
                        
                     </div>
                     
                     <p class="title"><b>To set up a <code class="code">GET</code> method with URL path parameters</b></p>
                     <ol>
                        <li>
                           
                           <p>Go to the API Gateway console.</p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>APIs</b>, choose the <b>LambdaCalc</b>
                              API you created previously.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the API&apos;s Resources navigation pane, choose
                              <b>/calc</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>From the <b>Actions</b> drop-down menu, choose
                              <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Name</b>, type
                              <strong class="userinput"><code>{operand1}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Path</b>, type
                              <strong class="userinput"><code>{operand1}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>/calc/{operand1}</b> resource you just
                              created.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>From the <b>Actions</b> drop-down menu, choose
                              <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Name</b>, type
                              <strong class="userinput"><code>{operand2}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Path</b>, type
                              <strong class="userinput"><code>{operand2}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>/calc/{operand1}/{operand2}</b> resource you just
                              created.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>From the <b>Actions</b> drop-down menu, choose
                              <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Path</b>, type
                              <strong class="userinput"><code>{operator}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Resource Name</b>, type
                              <strong class="userinput"><code>{operator}</code></strong>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create Resource</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose the <b>/calc/{operand1}/{operand2}/{operator}</b>
                              resource you just created.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>From the <b>Actions</b> drop-down menu, choose <b>Create
                                 Method</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>From the method drop-down menu, choose <code class="code">GET</code>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Setup</b> pane, choose <code class="code">Lambda Function</code>
                              for <b>Integration type</b>, to use the streamlined setup process
                              enabled by the console.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose a region (e.g., <code class="code">us-west-2</code>) for <b>Lambda
                                 Region</b>. This is the region where the Lambda function is
                              hosted.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose your existing Lambda function (<code class="code">Calc</code>) for <b>Lambda
                                 Function</b>. 
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Save</b> and then choose <b>OK</b> to
                              consent to <b>Add Permissions to Lambda Function</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Integration Request</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Set up the mapping template as follows:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Expand the <b>Mapping Templates</b> section.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Leave set to <b>When no template matches the requested
                                       Content-Type header</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Add mapping template</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <code class="code">application/json</code> for
                                    <b>Content-Type</b> and then choose the check mark
                                    icon to open the template editor.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Yes, secure this integration</b> to
                                    proceed.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Copy the following mapping script into the template editor:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
   &quot;a&quot;: &quot;$input.params(&apos;operand1&apos;)&quot;,
   &quot;b&quot;: &quot;$input.params(&apos;operand2&apos;)&quot;,
   &quot;op&quot;: #if($input.params(&apos;operator&apos;)==&apos;%2F&apos;)&quot;/&quot;#{else}&quot;$input.params(&apos;operator&apos;)&quot;#end
   
}</code></pre>
                                 <p>This template maps the three URL path parameters, declared when the
                                    <b>/calc/{operand1}/{operand2}/{operator}</b> resource
                                    was created, into designated property values in the JSON object. Because
                                    URL paths must be URL-encoded, the division operator must be specified
                                    as <code class="code">%2F</code> instead of <code class="code">/</code>. This template translates
                                    the <code class="code">%2F</code> into <code class="code">&apos;/&apos;</code> before passing it to the
                                    Lambda function. 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                           <p>When the method is set up correctly, the settings should look more or less
                              like this: 
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="../../..//img/aws_proxy_lambda_calc_get_method_with_paths_settings.png" alt="
                        Set up the GET method with path parameters to invoke
                            the Lambda function
                    " style="max-width:100%">
                              
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>To test your <code class="code">GET</code> function, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Method Execution</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <strong class="userinput"><code>1</code></strong>, <strong class="userinput"><code>2</code></strong> and
                                    <strong class="userinput"><code>+</code></strong> in the <b>{operand1}</b>,
                                    <b>{operand2}</b> and <b>{operator}</b>
                                    fields, respectively.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>The result should look like this:</p>
                                 
                                 <div class="mediaobject">
                                    
                                    <img src="../../..//img/aws_proxy_lambda_calc_get_method_test_result.png" alt="
                                Map a method request URL path parameters to the integration
                                    request payload to call the Lambda function
                            " style="max-width:100%">
                                    
                                    
                                    
                                 </div>
                                 
                              </li>
                           </ol>
                           
                           <p>This test result shows the original output from the backend Lambda function, as
                              passed through the integration response without mapping, because there is no
                              mapping template. Next, you&apos;ll model the data structure of the method response
                              payload after the <code class="code">Result</code> schema.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>By default, the method response body is assigned an empty model. This will
                              cause the integration response body to be passed through without mapping.
                              However, when you generate an SDK for one of the strongly-type languages, such
                              as Java or Objective-C, your SDK users will receive an empty object as the
                              result. To ensure that both the REST client and SDK clients receive the desired
                              result, you must model the response data using a predefined schema. Here you&apos;ll
                              define a model for the method response body and to construct a mapping template
                              to translate the integration response body into the method response body.
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose
                                    <b>/calc/{operand1}/{operand2}/{operator}</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>GET</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Method Execution</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Method Response</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Expand the <b>200</b> response, 
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Under <b>Response Body for 200</b>, choose the pencil
                                    icon next to the model for the <code class="code">application/json</code> content
                                    type.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>From the <b>Models</b> drop-down list, choose
                                    <code class="code">Result</code>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose the checkmark icon to save your choice.</p>
                                 
                              </li>
                           </ol>
                           
                           <p>Setting the model for the method response body ensures that the response data
                              will be cast into the <code class="code">Result</code> object of a given SDK. To make sure
                              that the integration response data is mapped accordingly, you&apos;ll need a mapping
                              template.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>To create the mapping template, do the following:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Method Execution</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p> Choose <b>Integration Response</b> and expand the 200
                                    method response entry.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Expand the <b>Mapping Templates</b> section.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <code class="code">application/json</code> from the
                                    <b>Content-Type</b> list.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <code class="code">Result</code> from the <b>Generate
                                       template</b> drop-down list to bring up the
                                    <code class="code">Result</code> template blueprint.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Change the template blueprint to the following:</p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">#set($inputRoot = $input.path(&apos;$&apos;))
{
  &quot;input&quot; : {
    &quot;a&quot; : $inputRoot.a,
    &quot;b&quot; : $inputRoot.b,
    &quot;op&quot; : &quot;$inputRoot.op&quot;
  },
  &quot;output&quot; : {
    &quot;c&quot; : $inputRoot.c
  }
}</code></pre>
                                 </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>To test the mapping template, do the following:</p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Method Execution</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Type <code class="code">1</code>
                                    <code class="code">2</code> and <code class="code">+</code> in the <b>operand1</b>,
                                    <b>operand2</b> and <b>operator</b>
                                    input fields, respectively.
                                 </p>
                                 
                                 <p>The integration response from the Lambda function is now mapped to a
                                    <code class="code">Result</code> object.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Test</b>, and you&apos;ll see the following under
                                    <b>Response Body</b> in the console:
                                 </p>
                                 <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
  &quot;input&quot;: {
    &quot;a&quot;: 1,
    &quot;b&quot;: 2,
    &quot;op&quot;: &quot;+&quot;
  },
  &quot;output&quot;: {
    &quot;c&quot;: 3
  }
}</code></pre>
                                 </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>At this point the API can be called only via <b>Test Invoke</b>
                              in the API Gateway console. To make it available to clients, you&apos;ll need to deploy
                              it
                              as follows:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>Choose <b>Deploy API</b> from the
                                    <b>Actions</b> dropdown menu.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>[New Stage]</b> from the
                                    <b>Deployment Stage</b> dropdown menu.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Stage Name</b>, enter
                                    <strong class="userinput"><code>test</code></strong>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Deploy</b>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Note the <b>Invoke URL</b> at the top of the console
                                    window. You can use this with tools such as <a href="http://www.getpostman.com" target="_blank">Postman</a> and <a href="https://curl.haxx.se/" target="_blank">cURL</a> to test your API.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                     </ol>
                     
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>Always be sure to redeploy your API whenever you add, modify, or delete a resource
                           or method, update a data mapping, or update stage settings. Otherwise, new features
                           or updates will not be available to clients of your API.
                        </p>
                     </div>
                     
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="getting-started-aws-proxy.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="api-as-lambda-proxy-export-swagger-with-extensions.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Create an AWS Account"><a class="pagetoc" href="#w20aac11c17c15">Create an AWS Account</a></li>
                        <li class="pagetoc" name="Create an Assumable IAM
                Role"><a class="pagetoc" href="#api-as-lambda-proxy-setup-iam-role-policies">Create an Assumable IAM
                              Role</a></li>
                        <li class="pagetoc" name="Create a Calc
                Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-create-lambda-function">Create a Calc
                              Lambda Function</a></li>
                        <li class="pagetoc" name="Test the Calc
                Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-create-lambda-function">Test the Calc
                              Lambda Function</a></li>
                        <li class="pagetoc" name="Create a Calc
                API"><a class="pagetoc" href="#api-as-lambda-proxy-create-api-resources">Create a Calc
                              API</a></li>
                        <li class="pagetoc" name="Integration 1: Create a GET Method with Query Parameters to Call the
                Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-expose-get-method-with-query-strings-to-call-lambda-function">Integration 1: Create a GET Method with Query Parameters to Call the
                              Lambda Function</a></li>
                        <li class="pagetoc" name="Integration 2: Create a POST Method with a JSON Payload to Call the
                Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-expose-post-method-with-json-body-to-call-lambda-function">Integration 2: Create a POST Method with a JSON Payload to Call the
                              Lambda Function</a></li>
                        <li class="pagetoc" name="Integration 3: Create a GET Method with Path Parameters to Call the
                Lambda Function"><a class="pagetoc" href="#api-as-lambda-proxy-expose-get-method-with-path-parameters-to-call-lambda-function">Integration 3: Create a GET Method with Path Parameters to Call the
                              Lambda Function</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>