<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>Set up a WebSocket API
         Integration Request in API Gateway - Amazon API Gateway
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="home" href="#top">
      <link rel="up" href="apigateway-websocket-api-integrations.html" title="Set up WebSocket API Integrations in
            API Gateway">
      <link rel="prev" href="apigateway-websocket-api-integrations.html" title="Set up WebSocket API Integrations in
            API Gateway">
      <link rel="next" href="apigateway-websocket-api-integration-responses.html" title="Set up WebSocket API
                Integration Responses in API Gateway">
      <meta name="description" content="Setting up an integration request involves the following:">
      <meta name="deployment_region" content="IAD">
      <meta name="product" content="Amazon API Gateway">
      <meta name="guide" content="Developer Guide">
      <meta name="guide-locale" content="en_us">
      <meta name="tocs" content="toc-contents.json">
      <meta name="marketingLocale" content="en_US">
      <link rel="icon" type="image/ico" href="/images/favicon.ico">
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico">
      <link rel="canonical" href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-websocket-api-integration-requests.html">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="../../../css/google-font.css">
      <link id="code-style" rel="stylesheet" type="text/css" href="../../../css/light.css">
      <link rel="stylesheet" type="text/css" href="../../../css/jquery-ui.theme.css">
      <link rel="stylesheet" type="text/css" href="../../../css/colorbox.css">
      <link rel="stylesheet" type="text/css" href="../../../css/awsdocs.css"><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20181221"></script><link rel="stylesheet" type="text/css" href="../../../css/marketing-target.css"><script type="text/javascript" src="/assets/marketing/js/marketing-target.js"></script></head>
   <body id="top">
      
      <div id="content-container">
         
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tbody><tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> &#xBB; <a href="/apigateway/index.html">Amazon API Gateway</a> &#xBB; <a href="index.html">Developer Guide</a> &#xBB; <a href="apigateway-websocket-api.html">Creating, Deploying, and Invoking a WebSocket API
                                    in Amazon API Gateway</a> &#xBB; <a href="apigateway-websocket-api-integrations.html">Set up WebSocket API Integrations in
                                    API Gateway</a> &#xBB; <span class="breadcrumb">Set up a WebSocket API
                                    Integration Request in API Gateway</span></div>
                           </td>
                        </tr>
                     </tbody></table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="apigateway-websocket-api-integration-requests">Set up a WebSocket API
                        Integration Request in API Gateway
                     </h1>
                     <p>Setting up an integration request involves the following:</p>
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>Choosing a route key to integrate to the backend.</p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Specifying the backend endpoint to invoke, such as an AWS service or HTTP
                                 endpoint.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>Configuring how to transform the route request data, if necessary, into
                                 integration request data by specifying one or more request templates.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     <h2 id="apigateway-websocket-api-integration-request-using-console">Set up
                        a WebSocket API Integration Request Using the API Gateway Console
                     </h2>
                     
                     <p class="title"><b>To add an integration request to a route in a WebSocket API using the API Gateway
                           console</b></p>
                     <ol>
                        <li>
                           
                           <p>Sign in to the API Gateway console, choose the API, and choose
                              <b>Routes</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Routes</b>, choose the route.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the <b>Route Overview</b> pane, choose
                              <b>Integration Request</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Integration Type</b>, choose one of the
                              following:
                           </p>
                           
                           <div class="itemizedlist">
                              
                              
                              
                              
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Choose <b>Lambda Function</b> only if your API will
                                       be integrated with an AWS Lambda function that you have already
                                       created in this account or in another account.
                                    </p>
                                    
                                    <p>To create a new Lambda function in AWS Lambda, to set a resource
                                       permission on the Lambda function, or to perform any other Lambda
                                       service actions, choose <b>AWS Service</b>
                                       instead.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Choose <b>HTTP</b> if your API will be integrated
                                       with an existing HTTP endpoint. For more information, see <a href="setup-http-integrations.html">Set up HTTP Integrations in API Gateway</a>.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Choose <b>Mock</b> if you want to generate API
                                       responses from API Gateway directly, without the need for an integration
                                       backend. For more information, see <a href="how-to-mock-integration.html">Set up Mock Integrations in API Gateway</a>.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Choose <b>AWS Service</b> if your API will be
                                       integrated with an AWS service.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Choose <b>VPC Link</b> if your API will use a
                                       <code class="code">VpcLink</code> as a private integration endpoint. For more
                                       information, see <a href="set-up-private-integration.html">Set up API Gateway Private Integrations</a>.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>If you chose <b>Lambda Function</b>, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Lambda Region</b>, choose the region
                                    identifier that corresponds to the region where you created the
                                    Lambda function. For example, if you created the Lambda function in
                                    the US East (N. Virginia) region, choose
                                    <strong class="userinput"><code>us-east-1</code></strong>. For a list of
                                    region names and identifiers, see <a href="./general/latest/gr/rande.html#lambda_region">AWS Lambda</a> in
                                    the <em>Amazon Web Services General Reference</em>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Use Lambda Proxy integration</b>, choose the
                                    checkbox if you intend to use <a href="set-up-lambda-proxy-integrations.html#api-gateway-create-api-as-simple-proxy">Lambda proxy
                                       integration</a> or <a href="apigateway-cross-account-lambda-integrations.html">cross-account Lambda proxy integration</a>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Lambda Function</b>, specify the function in
                                    one of the following ways:
                                 </p>
                                 
                                 <div class="itemizedlist">
                                    
                                    
                                    
                                    <ul class="itemizedlist" type="disc">
                                       <li class="listitem">
                                          
                                          <p>If your Lambda function is in the same account, start
                                             typing the function name and then choose the function from
                                             the dropdown list.
                                          </p>
                                          
                                          <div class="aws-note">
                                             <p class="aws-note">Note</p>
                                             <p>The function name can optionally include its alias or
                                                version specification, as in <code class="code">HelloWorld</code>,
                                                <code class="code">HelloWorld:1</code>, or
                                                <code class="code">HelloWorld:alpha</code>.
                                             </p>
                                          </div>
                                          
                                       </li>
                                       <li class="listitem">
                                          
                                          <p>If the function is in a different account, type the ARN
                                             for the function.
                                          </p>
                                          
                                       </li>
                                    </ul>
                                 </div>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Invoke with caller credentials</b> if you
                                    want API Gateway to invoke your Lambda function using credentials received
                                    in the incoming request.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Execution role</b>, type the ARN of the Lambda
                                    invocation role that enables API Gateway to invoke your Lambda
                                    functions.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>To use the default timeout value of 29 seconds, leave
                                    <b>Use Default Timeout</b> selection checked. To
                                    set a custom timeout, uncheck the box, and enter a timeout value
                                    between <code class="code">50</code> and <code class="code">29000</code> milliseconds.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>Choose <b>Save</b>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>If you chose <b>HTTP</b>, follow the instructions in step 4
                              of <a href="how-to-method-settings-console.html">Set up an API Integration Request
                                 Using the API Gateway Console</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>If you chose <b>Mock</b>, proceed to the <b>Request
                                 Templates</b> step.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>If you chose <b>AWS Service</b>, follow the instructions
                              in step 6 of <a href="how-to-method-settings-console.html">Set up an API Integration Request
                                 Using the API Gateway Console</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>If you chose <b>VPC Link</b>, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Use Proxy integration</b>, choose the
                                    checkbox if you want requests to be proxied to your
                                    <code class="code">VPCLink</code>&apos;s endpoint.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>From the <b>VPC Link</b> dropdown list, choose
                                    <code class="code">[Use Stage Variables]</code> and type
                                    <code class="code">${stageVariables.vpcLinkId}</code> in the text box below
                                    the list.
                                 </p>
                                 
                                 <p>We will define the <code class="code">vpcLinkId</code> stage variable after
                                    deploying the API to a stage and set its value to the ID of the
                                    <code class="code">VpcLink</code>.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>HTTP method</b>, choose the HTTP method type
                                    that most closely matches the method in the HTTP backend.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>For <b>Endpoint URL</b>, type the URL of the HTTP
                                    backend you want this integration to use.
                                 </p>
                                 
                              </li>
                              <li>
                                 
                                 <p>To use the default timeout value of 29 seconds, leave
                                    <b>Use Default Timeout</b> selection checked. To
                                    set a custom timeout, uncheck the box, and enter a timeout value
                                    between <code class="code">50</code> and <code class="code">29000</code> milliseconds.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Request Templates</b>, do the following:
                           </p>
                           
                           <ol>
                              <li>
                                 
                                 <p>For <b>Template Selection Expression</b>, choose the
                                    pencil icon and replace the word <code class="code">template</code> with a
                                    template selection expression. This is an expression that API Gateway
                                    looks for in the message payload. If it is found, it is evaluated,
                                    and the result is a template key value that is used to select the
                                    data mapping template to be applied to the data in the message
                                    payload.
                                 </p>
                                 
                                 <p>For information about template selection expressions, see <a href="apigateway-websocket-api-selection-expressions.html#apigateway-websocket-api-template-selection-expressions">Template
                                       Selection Expressions</a>.
                                 </p>
                                 
                              </li>
                           </ol>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="apigateway-websocket-api-integration-request-using-awscli">Set up
                        an Integration Request Using the AWS CLI
                     </h2>
                     
                     <p>You can set up an integration request for a route in a WebSocket API by using the
                        AWS CLI as in the following example, which creates a mock integration:
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>Create a file named <code class="code">integration-params.json</code>, with the
                              following contents:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{&quot;PassthroughBehavior&quot;: &quot;WHEN_NO_MATCH&quot;, &quot;TimeoutInMillis&quot;: 29000, &quot;ConnectionType&quot;: &quot;INTERNET&quot;, &quot;RequestTemplates&quot;: {&quot;application/json&quot;: &quot;{\&quot;statusCode\&quot;:200}&quot;}, &quot;IntegrationType&quot;: &quot;MOCK&quot;}</code></pre>
                           </li>
                        <li>
                           
                           
                           <p>Run the <a href="./goto/aws-cli/apigatewayv2-2018-11-29/CreateIntegration"><code class="code">create-integration</code></a> command as shown in the
                              following example:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigatewayv2 --region us-east-1 create-integration --api-id aabbccddee --cli-input-json file://integration-params.json</code></pre>
                           </li>
                     </ol>
                     
                     <p>Following is sample output for this example:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;PassthroughBehavior&quot;: &quot;WHEN_NO_MATCH&quot;,
    &quot;TimeoutInMillis&quot;: 29000,
    &quot;ConnectionType&quot;: &quot;INTERNET&quot;,
    &quot;IntegrationResponseSelectionExpression&quot;: &quot;${response.statuscode}&quot;,
    &quot;RequestTemplates&quot;: {
        &quot;application/json&quot;: &quot;{\&quot;statusCode\&quot;:200}&quot;
    },
    &quot;IntegrationId&quot;: &quot;0abcdef&quot;,
    &quot;IntegrationType&quot;: &quot;MOCK&quot;
}</code></pre>
                     <p>Alternatively, you can set up an integration request for a proxy integration by
                        using the AWS CLI as in the following example:
                     </p>
                     
                     <ol>
                        <li>
                           
                           <p>Create a Lambda function in the Lambda console and give it a basic Lambda
                              execution role.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Execute the <a href="./goto/aws-cli/apigatewayv2-2018-11-29/CreateIntegration"><code class="code">create-integration</code></a> command as in the following
                              example:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws apigatewayv2 create-integration --api-id <em class="replaceable"><code>aabbccddee</code></em> --integration-type AWS_PROXY --integration-method POST --integration-uri arn:aws:apigateway:<em class="replaceable"><code>us-east-1</code></em>:lambda:path/2015-03-31/functions/arn:aws:lambda:<em class="replaceable"><code>us-east-1</code></em>:<em class="replaceable"><code>123412341234</code></em>:function:<em class="replaceable"><code>simpleproxy-echo-e2e</code></em>/invocations</code></pre>
                           </li>
                     </ol>
                     
                     <p>Following is sample output for this example:</p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">{
    &quot;PassthroughBehavior&quot;: &quot;WHEN_NO_MATCH&quot;,
    &quot;IntegrationMethod&quot;: &quot;POST&quot;,
    &quot;TimeoutInMillis&quot;: 29000,
    &quot;ConnectionType&quot;: &quot;INTERNET&quot;,
    &quot;IntegrationUri&quot;: &quot;arn:aws:apigateway:<em class="replaceable"><code>us-east-1</code></em>:lambda:path/2015-03-31/functions/arn:aws:lambda:<em class="replaceable"><code>us-east-1</code></em>:<em class="replaceable"><code>123412341234</code></em>:function:<em class="replaceable"><code>simpleproxy-echo-e2e</code></em>/invocations&quot;,
    &quot;IntegrationId&quot;: &quot;<em class="replaceable"><code>abcdefg</code></em>&quot;,
    &quot;IntegrationType&quot;: &quot;AWS_PROXY&quot;
}</code></pre>
                     <div id="marketing-target"><span class="close-button"></span><div class="marketing-title" id="marketing-title"></div>
                        <div class="marketing-description"><span id="marketing-description"></span><span id="marketing-cta"></span></div>
                     </div>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your
                                       browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be
                                    enabled. Please refer to your browser's Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="apigateway-websocket-api-integrations.html">&#xAB; Previous </a><a class="awstoc" accesskey="n" href="apigateway-websocket-api-integration-responses.html">Next &#xBB;</a></div>
                     <div id="copyright-main-footer">&#xA9; 2019, Amazon Web Services, Inc. or its affiliates. All rights
                        reserved.
                     </div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Set up
                    a WebSocket API Integration Request Using the API Gateway Console"><a class="pagetoc" href="#apigateway-websocket-api-integration-request-using-console">Set up
                              a WebSocket API Integration Request Using the API Gateway Console</a></li>
                        <li class="pagetoc" name="Set up
                    an Integration Request Using the AWS CLI"><a class="pagetoc" href="#apigateway-websocket-api-integration-request-using-awscli">Set up
                              an Integration Request Using the AWS CLI</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using
            our site, you consent to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon API Gateway';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   
</body></html>